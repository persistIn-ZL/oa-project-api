var Pe=Object.defineProperty,Re=Object.defineProperties;var Ue=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var ie=(e,s,c)=>s in e?Pe(e,s,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[s]=c,oe=(e,s)=>{for(var c in s||(s={}))Te.call(s,c)&&ie(e,c,s[c]);if(ue)for(var c of ue(s))Fe.call(s,c)&&ie(e,c,s[c]);return e},te=(e,s)=>Re(e,Ue(s));import{d as Oe,c as pe,r as m,a as B,f as De,a6 as me,q as i,a3 as je,t as v,y as M,k as a,x as t,z as S,a4 as O,S as g,R as f,v as k,a5 as Le,D as E,F as le,X as se,n as ze,M as D}from"./ant-design-vue.27440fdb.js";import{g as q,s as Be}from"./dictFormat.31da75fc.js";import{g as ce}from"./index.0e842432.js";import{g as Ee,d as qe,l as $e,u as Ke,e as Ve,r as Ae}from"./index.92931a1b.js";import{g as Me}from"./index.004b7213.js";import{_ as Qe,u as Xe,a as Ge,h as fe}from"./index.da4ff793.js";import{u as He}from"./useDrawer.8b3a90cf.js";import{T as Je,f as re}from"./validate.f7694c3d.js";import{D as We}from"./index.c085a377.js";import{F as Ye}from"./index.ab3e0a2d.js";import{u as Ze}from"./useI18n.25a437e0.js";const{t:d}=Ze(),_e=[{title:d("routes.user.userName"),dataIndex:"userName",key:"userName",align:"center"},{title:d("routes.user.nickName"),dataIndex:"nickName",key:"nickName",align:"center"},{title:d("routes.user.roleIds"),key:"roles",align:"center",slots:{customRender:"roles"}},{title:d("routes.user.department"),key:"department",align:"center",slots:{customRender:"department"}},{title:d("routes.user.position"),key:"position",align:"center",slots:{customRender:"position"}},{title:d("routes.user.mobile"),key:"mobile",dataIndex:"mobile",align:"center"},{title:d("routes.user.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:d("routes.user.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:d("routes.user.action"),key:"action",align:"center",slots:{customRender:"action"}}],xe=Oe({components:{Treeselect:Je,DeptSearch:We,FormSearch:Ye},setup(){const e=Xe(),s=pe(()=>Ge().loading),c=m([]),Q=m([]),X=m([]),G=m([]),j=m([]),u=m([]),$=m(),h=m([]),K={children:"children",title:"deptName",key:"deptId"},N=m([]),H=l=>{r.deptId=l[0],L(r)},J=m(),r=B({userName:"",deptId:0,roleId:"",pageNum:1,pageSize:10}),P=B([{type:"input",label:d("routes.user.userName"),name:"userName",value:void 0,placeholder:d("routes.user.userNamePlaceholder")},{type:"select",label:d("routes.user.roleIds"),name:"roleId",value:void 0,placeholder:d("routes.user.roleIdsPlaceholder"),normalizer:{value:"id",label:"roleName"},options:c}]),L=l=>{b.value.current=1,r.pageNum=b.value.current,r.userName=l.userName,r.roleId=l.roleId,U(r)},w=B({selectedRowKeys:[]}),y=m([]),b=m({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:l=>`\u5171 ${l} \u6761`}),W=l=>{b.value=l,r.pageNum=b.value.current,r.pageSize=b.value.pageSize,U(r)},V=pe(()=>w.selectedRowKeys.length>0),Y=l=>{w.selectedRowKeys=l},Z=l=>l.roles.map(p=>p.roleName).join(","),_=()=>{T.value=!0,ae.value=!1,ee.value=d("common.add")},x=l=>{Ee(l.id).then(p=>{T.value=!0,ae.value=!0,ee.value=d("common.update"),ze(()=>{Object.keys(n).forEach(F=>{n[F]=p.data[F]}),n.roleIds=p.data.roles.map(F=>F.id),ne.value.forest.selectedNodeIds.push(p.data.deptId),console.log(n)})})},I=l=>{const p=l.id||w.selectedRowKeys;console.log(p),qe(p).then(()=>{(p.length&&p.length===y.value.length||y.value.length===1)&&Math.ceil(b.value.total/r.pageSize)===r.pageNum&&r.pageNum>1&&r.pageNum--,U(r),D.success(d("common.deleteSuccess"))})},o=l=>{console.log(l),D.success(d("common.cancelDelete"))},R=m([]),U=l=>{$e(l).then(p=>{y.value=p.data.rows,b.value.total=p.data.count}),ce().then(p=>{const F=fe(p.data.rows,"deptId","parentId","children",e.userInfo.deptId).tree,de=p.data.rows.filter(Ne=>Ne.deptId===e.userInfo.deptId);de[0].children=F,R.value=de,console.log(R)})},ne=m(),n=B({id:void 0,deptId:void 0,nickName:void 0,userName:void 0,password:void 0,sex:"1",roleIds:[],mobile:void 0,status:"1",email:void 0,salary:void 0,position:"1",entryTime:void 0,birthday:void 0,education:void 0,remark:void 0}),ve={deptId:[{required:!0,validator:re.number,message:d("routes.user.deptIdCannotBeEmpty"),trigger:"change"}],nickName:[{required:!0,message:d("routes.user.nickNameCannotBeEmpty"),trigger:"blur"}],userName:[{required:!0,message:d("routes.user.userNameCannotBeEmpty"),trigger:"blur"}],password:[{required:!0,message:d("routes.user.passwordCannotBeEmpty"),trigger:"blur"}],roleIds:[{required:!0,validator:re.checkRoleLength,trigger:"change"}],position:[{required:!0,message:d("routes.user.positionCannotBeEmpty"),trigger:"change"}],salary:[{required:!0,validator:re.number,message:d("routes.user.salaryCannotBeEmpty"),trigger:"blur"}]},{open:T,drawerTitle:ee}=He(),ae=m(!1),he=l=>{n.deptId=l.deptId},z=m(),be=()=>{console.log(n),z.value.validate().then(()=>{n.id?Ke(n).then(l=>{D.success(l.message),n.id=void 0,n.deptId=void 0,n.password=void 0,n.userName=void 0,n.roleIds=void 0,z.value.resetFields(),T.value=!1,U(r)}):Ve(n).then(l=>{D.success(l.message),n.id=void 0,n.deptId=void 0,n.password=void 0,n.userName=void 0,n.roleIds=void 0,z.value.resetFields(),T.value=!1,U(r)})}).catch(l=>{console.log("error",l)})},ge=l=>(l.children&&!l.children.length&&delete l.children,{id:l.deptId,label:l.deptName,children:l.children}),we=()=>{n.id=void 0,n.deptId=void 0,n.password=void 0,n.userName=void 0,z.value.resetFields(),console.log(n),T.value=!1},A=m(!1),C=B({id:0,newPassword:""}),ye=l=>{C.id=l.id,A.value=!0},Se=()=>{if(!C.newPassword){D.error(d("routes.user.newPasswordCannotBeEmpty"));return}Ae(C.id,{newPassword:C.newPassword}).then(l=>{D.success(l.message),C.newPassword="",A.value=!1})},ke=()=>{C.newPassword="",A.value=!1},Ie=()=>{ce().then(l=>{h.value=l.data.rows,N.value=fe(l.data.rows,"deptId","parentId","children",0).tree,$.value.expandedKeys.value=h.value.map(p=>p.id)})},Ce=()=>{Ie(),U(r),Me().then(l=>{c.value=l.data.rows})};return De(async()=>{Q.value=await q("sys_normal_disable"),X.value=await q("sys_user_position"),G.value=await q("sys_user_education"),j.value=await q("sys_normal_disable"),u.value=await q("sys_user_sex"),j.value.forEach(l=>{l.label=l.dictLabel,l.value=l.dictValue}),u.value.forEach(l=>{l.label=l.dictLabel,l.value=l.dictValue}),Ce()}),te(oe(te(oe({t:d,loading:s,replaceFields:K,deptSearchRef:$,originalTree:h,deptTreeOption:N,handleSelect:H,queryRef:J,queryParams:r,formFields:P,handleQuery:L,statusOptions:Q,columns:_e},me(w)),{userList:y,pagination:b,handleTableChange:W,selectDictLabel:Be,hasSelected:V,onSelectChange:Y,getRoles:Z,confirm:I,cancel:o,handleAdd:_,handleUpdate:x,treeRef:ne,formRef:z,rules:ve,isUpdate:ae,open:T,drawerTitle:ee,deptOptions:R,normalizer:ge,handleClose:we,handleSubmit:be,labelCol:{span:6},wrapperCol:{span:18},formState:n,roleOptions:c,handleTreeSelect:he,positionOptions:X,educationOptions:G,disableOptions:j,sexOptions:u,visible:A}),me(C)),{handleResetPwd:Se,handleResetClose:ke,showModal:ye})}}),ea={class:"p-4"},aa={class:"mb-3"},oa={class:"flex items-center"},ta={class:"whitespace-nowrap"};function la(e,s,c,Q,X,G){const j=i("dept-search"),u=i("a-col"),$=i("form-search"),h=i("a-button"),K=i("a-popconfirm"),N=i("a-row"),H=i("a-table"),J=i("treeselect"),r=i("a-form-item"),P=i("a-input"),L=i("a-input-password"),w=i("a-select-option"),y=i("a-select"),b=i("a-radio-group"),W=i("a-input-number"),V=i("a-date-picker"),Y=i("a-textarea"),Z=i("a-form"),_=i("a-drawer"),x=i("a-modal"),I=je("has-permi");return v(),M("div",ea,[a(N,{gutter:15},{default:t(()=>[a(u,{span:4},{default:t(()=>[a(j,{ref:"deptSearchRef",original:e.originalTree,data:e.deptTreeOption,baseFields:e.replaceFields,onSelect:e.handleSelect},null,8,["original","data","baseFields","onSelect"])]),_:1}),a(u,{span:20},{default:t(()=>[S("div",aa,[a($,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),a(N,{gutter:10,class:"mb-2"},{default:t(()=>[O(a(u,null,{default:t(()=>[a(h,{color:"success",onClick:e.handleAdd},{default:t(()=>[g(f(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[I,["system:user:add"]]]),O(a(u,null,{default:t(()=>[a(K,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:t(()=>[a(h,{disabled:!e.hasSelected,color:"error"},{default:t(()=>[g(f(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[I,["system:user:delete"]]])]),_:1}),a(H,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.userList,pagination:e.pagination,onChange:e.handleTableChange},{department:t(({record:o})=>[S("span",null,f(o.department.deptName),1)]),status:t(({record:o})=>[S("span",null,f(e.selectDictLabel(e.statusOptions,o.status)),1)]),roles:t(({record:o})=>[S("span",null,f(e.getRoles(o)),1)]),position:t(({record:o})=>[S("span",null,f(e.selectDictLabel(e.positionOptions,o.position)),1)]),action:t(({record:o})=>[S("span",null,[O(a(h,{type:"link",color:"success",class:"mr-3",onClick:R=>e.handleUpdate(o)},{default:t(()=>[g(f(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[I,["system:user:update"]]]),O(a(h,{type:"link",color:"success",class:"mr-3",onClick:R=>e.showModal(o)},{default:t(()=>[g(f(e.t("routes.user.resetPwd")),1)]),_:2},1032,["onClick"]),[[I,["system:user:resetPwd"]]]),a(K,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:R=>e.confirm(o),onCancel:e.cancel},{default:t(()=>[O(a(h,{type:"link",color:"error"},{default:t(()=>[g(f(e.t("common.delete")),1)]),_:1},512),[[I,["system:user:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"])]),_:1})]),_:1}),a(_,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":s[15]||(s[15]=o=>e.open=o),maskClosable:!1,onClose:e.handleClose},{default:t(()=>[e.open?(v(),k(Z,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:t(()=>[a(N,null,{default:t(()=>[O(a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.deptId"),name:"deptId"},{default:t(()=>[a(J,{ref:"treeRef",class:"!mt-[3px]",value:e.formState.deptId,"onUpdate:value":s[0]||(s[0]=o=>e.formState.deptId=o),normalizer:e.normalizer,placeholder:e.t("routes.user.deptIdPlaceholder"),options:e.deptOptions,onSelect:e.handleTreeSelect},null,8,["value","normalizer","placeholder","options","onSelect"])]),_:1},8,["label"])]),_:1},512),[[Le,e.formState.deptId!==0]]),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.nickName"),name:"nickName"},{default:t(()=>[a(P,{value:e.formState.nickName,"onUpdate:value":s[1]||(s[1]=o=>e.formState.nickName=o),placeholder:e.t("routes.user.nickNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e.isUpdate?E("",!0):(v(),k(u,{key:0,span:12},{default:t(()=>[a(r,{label:e.t("routes.user.userName"),name:"userName"},{default:t(()=>[a(P,{value:e.formState.userName,"onUpdate:value":s[2]||(s[2]=o=>e.formState.userName=o),placeholder:e.t("routes.user.userNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})),e.isUpdate?E("",!0):(v(),k(u,{key:1,span:12},{default:t(()=>[a(r,{label:e.t("routes.user.password"),name:"password"},{default:t(()=>[a(L,{value:e.formState.password,"onUpdate:value":s[3]||(s[3]=o=>e.formState.password=o),placeholder:e.t("routes.user.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.roleIds"),name:"roleIds"},{default:t(()=>[a(y,{mode:"multiple",value:e.formState.roleIds,"onUpdate:value":s[4]||(s[4]=o=>e.formState.roleIds=o),placeholder:e.t("routes.user.roleIdsPlaceholder")},{default:t(()=>[(v(!0),M(le,null,se(e.roleOptions,o=>(v(),k(w,{key:o.id},{default:t(()=>[g(f(o.roleName),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.position"),name:"position"},{default:t(()=>[a(y,{value:e.formState.position,"onUpdate:value":s[5]||(s[5]=o=>e.formState.position=o),placeholder:e.t("routes.user.positionPlaceholder")},{default:t(()=>[(v(!0),M(le,null,se(e.positionOptions,o=>(v(),k(w,{value:o.dictValue,key:o.id},{default:t(()=>[g(f(o.dictLabel),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.sex"),name:"sex"},{default:t(()=>[a(b,{value:e.formState.sex,"onUpdate:value":s[6]||(s[6]=o=>e.formState.sex=o),options:e.sexOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.mobile"),name:"mobile"},{default:t(()=>[a(P,{value:e.formState.mobile,"onUpdate:value":s[7]||(s[7]=o=>e.formState.mobile=o),placeholder:e.t("routes.user.mobilePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.status"),name:"status"},{default:t(()=>[a(b,{value:e.formState.status,"onUpdate:value":s[8]||(s[8]=o=>e.formState.status=o),options:e.disableOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.email"),name:"email"},{default:t(()=>[a(P,{value:e.formState.email,"onUpdate:value":s[9]||(s[9]=o=>e.formState.email=o),placeholder:e.t("routes.user.emailPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),e.formState.position!=="1"?(v(),k(u,{key:2,span:12},{default:t(()=>[a(r,{label:e.t("routes.user.salary"),name:"salary"},{default:t(()=>[a(W,{class:"!w-[100%]",value:e.formState.salary,"onUpdate:value":s[10]||(s[10]=o=>e.formState.salary=o),placeholder:e.t("routes.user.salaryPlaceholder"),precision:2,formatter:o=>`\uFFE5 ${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:o=>o.replace(/\￥\s?|(,*)/g,"")},null,8,["value","placeholder","formatter","parser"])]),_:1},8,["label"])]),_:1})):E("",!0),e.formState.position!=="1"?(v(),k(u,{key:3,span:12},{default:t(()=>[a(r,{label:e.t("routes.user.entryTime"),name:"entryTime"},{default:t(()=>[a(V,{class:"!w-[100%]",value:e.formState.entryTime,"onUpdate:value":s[11]||(s[11]=o=>e.formState.entryTime=o),placeholder:e.t("routes.user.entryTimePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1})):E("",!0),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.birthday"),name:"birthday"},{default:t(()=>[a(V,{class:"!w-[100%]",value:e.formState.birthday,"onUpdate:value":s[12]||(s[12]=o=>e.formState.birthday=o),placeholder:e.t("routes.user.birthdayPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.education"),name:"education"},{default:t(()=>[a(y,{allowClear:"",value:e.formState.education,"onUpdate:value":s[13]||(s[13]=o=>e.formState.education=o),placeholder:e.t("routes.user.educationPlaceholder")},{default:t(()=>[(v(!0),M(le,null,se(e.educationOptions,o=>(v(),k(w,{value:o.dictValue,key:o.id},{default:t(()=>[g(f(o.dictLabel),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:12},{default:t(()=>[a(r,{label:e.t("routes.user.remark"),name:"remark"},{default:t(()=>[a(Y,{rows:3,value:e.formState.remark,"onUpdate:value":s[14]||(s[14]=o=>e.formState.remark=o),placeholder:e.t("routes.user.remarkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(u,{span:24},{default:t(()=>[a(r,null,{default:t(()=>[a(h,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:t(()=>[g(f(e.t("common.okText")),1)]),_:1},8,["onClick"]),a(h,{onClick:e.handleClose},{default:t(()=>[g(f(e.t("common.cancelText")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","label-col","wrapper-col"])):E("",!0)]),_:1},8,["title","visible","onClose"]),a(x,{visible:e.visible,"onUpdate:visible":s[17]||(s[17]=o=>e.visible=o),title:e.t("routes.user.resetPwd"),onOk:e.handleResetPwd,onCancel:e.handleResetClose},{default:t(()=>[S("div",oa,[S("span",ta,f(e.t("routes.user.newPassword"))+"\uFF1A",1),a(L,{value:e.newPassword,"onUpdate:value":s[16]||(s[16]=o=>e.newPassword=o),placeholder:e.t("routes.user.newPasswordPlaceholder")},null,8,["value","placeholder"])])]),_:1},8,["visible","title","onOk","onCancel"])])}var ba=Qe(xe,[["render",la]]);export{ba as default};
