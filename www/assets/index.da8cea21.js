import{g as y,s as te}from"./dictFormat.31da75fc.js";import{g as P}from"./index.0e842432.js";import{g as oe,l as se,u as ne,e as le}from"./index.92931a1b.js";import{g as ie}from"./index.004b7213.js";import{_ as re,u as de,a as ce,h as q}from"./index.da4ff793.js";import{u as ue}from"./useDrawer.8b3a90cf.js";import{D as pe}from"./index.c085a377.js";import{B as me}from"./index.7fa8a761.js";import{F as ve}from"./index.ab3e0a2d.js";import{u as he}from"./useI18n.25a437e0.js";import{d as fe,c as ge,r as o,a as S,f as ye,q as d,a3 as be,t as De,y as we,k as i,x as r,z as b,R as I,a4 as _e,S as ke,n as Se,M}from"./ant-design-vue.27440fdb.js";const{t:s}=he(),Ie=[{title:s("routes.holidayDetails.nickName"),dataIndex:"nickName",key:"nickName",align:"center"},{title:s("routes.holidayDetails.department"),key:"department",align:"center",slots:{customRender:"department"}},{title:s("routes.holidayDetails.position"),key:"position",align:"center",slots:{customRender:"position"}},{title:s("routes.holidayDetails.annualLeave"),key:"annualLeave",dataIndex:"annualLeave",align:"center"},{title:s("routes.holidayDetails.compensatoryLeave"),dataIndex:"compensatoryLeave",key:"compensatoryLeave",align:"center"},{title:s("routes.holidayDetails.action"),key:"action",align:"center",slots:{customRender:"action"}}],Ce=fe({components:{BaseForm:me,DeptSearch:pe,FormSearch:ve},setup(){const a=de(),D=ge(()=>ce().loading),m=o(),C=o([]),L=o([]),N=o([]),w=o([]),u=o([]),v=o([]),_=o(),h=o([]),F={children:"children",title:"deptName",key:"deptId"},k=o([]),R=e=>{t.deptId=e[0],B(t)},j=o(),t=S({nickName:"",deptId:0,pageNum:1,pageSize:10}),T=S([{type:"input",label:s("routes.holidayDetails.nickName"),name:"nickName",value:void 0,placeholder:s("routes.holidayDetails.nickNamePlaceholder")}]),B=e=>{c.value.current=1,t.pageNum=c.value.current,t.nickName=e.nickName,f(t)},U=o([]),c=o({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:e=>`\u5171 ${e} \u6761`}),Q=e=>{c.value=e,t.pageNum=c.value.current,t.pageSize=c.value.pageSize,f(t)},K=e=>e.roles.map(n=>n.roleName).join(","),A=e=>{oe(e.id).then(n=>{g.value=!0,V.value=!0,$.value=s("common.update"),Se(()=>{Object.keys(l).forEach(p=>{l[p]=n.data[p]}),l.roleIds=n.data.roles.map(p=>p.id),z.value.forest.selectedNodeIds.push(n.data.deptId),console.log(l)})})},O=o([]),f=e=>{se(e).then(n=>{U.value=n.data.rows,c.value.total=n.data.count}),P().then(n=>{const p=q(n.data.rows,"deptId","parentId","children",a.userInfo.deptId).tree,E=n.data.rows.filter(ae=>ae.deptId===a.userInfo.deptId);E[0].children=p,O.value=E,console.log(O)})},z=o(),G=S([{name:"annualLeave",label:s("routes.holidayDetails.annualLeave"),type:"input-number",value:void 0,span:24,labelCol:8,placeholder:s("routes.holidayDetails.annualLeavePlaceholder")},{name:"compensatoryLeave",label:s("routes.holidayDetails.compensatoryLeave"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:s("routes.holidayDetails.compensatoryLeavePlaceholder")}]),l=S({id:void 0,deptId:void 0,nickName:void 0,userName:void 0,password:void 0,sex:"1",roleIds:[],mobile:void 0,status:"1",email:void 0,salary:void 0,position:"1",entryTime:"",birthday:"",education:void 0,annualLeave:void 0,compensatoryLeave:void 0,remark:void 0}),H={},{open:g,drawerTitle:$}=ue(),V=o(!1),J=o(),W=()=>{l.id?ne(l).then(e=>{M.success(e.message),f(t),l.id=void 0,m.value.resetFields(),g.value=!1}):le(l).then(e=>{M.success(e.message),f(t),l.id=void 0,m.value.resetFields(),g.value=!1})},X=()=>{l.id=void 0,m.value.resetFields(),g.value=!1},Y=e=>(e.children&&!e.children.length&&delete e.children,{id:e.deptId,label:e.deptName,children:e.children}),Z=o(!1),x=()=>{P().then(e=>{h.value=e.data.rows,k.value=q(e.data.rows,"deptId","parentId","children",0).tree,_.value.expandedKeys.value=h.value.map(n=>n.id)})},ee=()=>{x(),f(t),ie().then(e=>{C.value=e.data.rows})};return ye(async()=>{L.value=await y("sys_normal_disable"),N.value=await y("sys_user_position"),w.value=await y("sys_user_education"),u.value=await y("sys_normal_disable"),v.value=await y("sys_user_sex"),u.value.forEach(e=>{e.label=e.dictLabel,e.value=e.dictValue}),v.value.forEach(e=>{e.label=e.dictLabel,e.value=e.dictValue}),ee()}),{t:s,loading:D,replaceFields:F,deptSearchRef:_,originalTree:h,deptTreeOption:k,handleSelect:R,queryRef:j,queryParams:t,formFields:T,handleQuery:B,statusOptions:L,columns:Ie,userList:U,pagination:c,handleTableChange:Q,selectDictLabel:te,getRoles:K,handleUpdate:A,BaseFormRef:m,formDataObj:G,treeRef:z,formRef:J,rules:H,isUpdate:V,open:g,drawerTitle:$,deptOptions:O,normalizer:Y,handleClose:X,handleSubmit:W,labelCol:{span:6},wrapperCol:{span:18},formState:l,roleOptions:C,positionOptions:N,educationOptions:w,disableOptions:u,sexOptions:v,visible:Z}}}),Le={class:"p-4"},Ne={class:"mb-3"};function Fe(a,D,m,C,L,N){const w=d("dept-search"),u=d("a-col"),v=d("form-search"),_=d("a-button"),h=d("a-table"),F=d("a-row"),k=d("BaseForm"),R=d("a-drawer"),j=be("has-permi");return De(),we("div",Le,[i(F,{gutter:15},{default:r(()=>[i(u,{span:4},{default:r(()=>[i(w,{ref:"deptSearchRef",original:a.originalTree,data:a.deptTreeOption,baseFields:a.replaceFields,onSelect:a.handleSelect},null,8,["original","data","baseFields","onSelect"])]),_:1}),i(u,{span:20},{default:r(()=>[b("div",Ne,[i(v,{formFields:a.formFields,onSearch:a.handleQuery,onReset:a.handleQuery},null,8,["formFields","onSearch","onReset"])]),i(h,{loading:a.loading,rowKey:"id",columns:a.columns,"data-source":a.userList,pagination:a.pagination,onChange:a.handleTableChange},{department:r(({record:t})=>[b("span",null,I(t.department.deptName),1)]),roles:r(({record:t})=>[b("span",null,I(a.getRoles(t)),1)]),position:r(({record:t})=>[b("span",null,I(a.selectDictLabel(a.positionOptions,t.position)),1)]),action:r(({record:t})=>[b("span",null,[_e(i(_,{type:"link",color:"success",class:"mr-3",onClick:T=>a.handleUpdate(t)},{default:r(()=>[ke(I(a.t("common.update")),1)]),_:2},1032,["onClick"]),[[j,["system:user:update"]]])])]),_:1},8,["loading","columns","data-source","pagination","onChange"])]),_:1})]),_:1}),i(R,{width:"540px",title:a.drawerTitle,placement:"right",visible:a.open,"onUpdate:visible":D[0]||(D[0]=t=>a.open=t),maskClosable:!1,onClose:a.handleClose},{default:r(()=>[i(k,{ref:"BaseFormRef",formData:a.formDataObj,data:a.formState,rules:a.rules,onSubmit:a.handleSubmit,onClose:a.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var qe=re(Ce,[["render",Fe]]);export{qe as default};
