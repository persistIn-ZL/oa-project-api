var te=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var Y=(e,n,r)=>n in e?te(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,$=(e,n)=>{for(var r in n||(n={}))le.call(n,r)&&Y(e,r,n[r]);if(M)for(var r of M(n))se.call(n,r)&&Y(e,r,n[r]);return e},x=(e,n)=>ne(e,oe(n));import{H as S,_ as re,a as ie}from"./index.da4ff793.js";import{g as H,s as ce}from"./dictFormat.31da75fc.js";import{F as de}from"./index.ab3e0a2d.js";import{B as ue}from"./index.7fa8a761.js";import{u as me}from"./useDrawer.8b3a90cf.js";import{u as pe}from"./useI18n.25a437e0.js";import{d as ve,c as U,r as C,a as w,f as fe,a6 as he,q as m,a3 as ge,t as P,y as q,z as T,k as c,x as s,a4 as R,S as _,R as h,F as ye,X as be,v as ke,M as L,n as V}from"./ant-design-vue.27440fdb.js";function Te(e={}){return S("/admin/examineAndApprove/leave","GET",e)}function Q(e){return S("/admin/examineAndApprove/leave/"+e,"GET",{},!1)}function Ae(e){return S("/admin/examineAndApprove/leave/"+e,"DELETE")}function Ce(e={}){return S("/admin/examineAndApprove/leave","POST",e)}function G(e){return S("/admin/examineAndApprove/leave/"+e.id,"PUT",e)}const{t}=pe(),we=[{title:t("routes.leave.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:t("routes.leave.leaveType"),dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:t("routes.leave.duration"),dataIndex:"leaveDuration",key:"leaveDuration",align:"center"},{title:t("routes.leave.leaveReason"),dataIndex:"leaveReason",key:"leaveReason",align:"center"},{title:t("routes.leave.startTime"),dataIndex:"startTime",key:"startTime",align:"center"},{title:t("routes.leave.endTime"),dataIndex:"endTime",key:"endTime",align:"center"},{title:t("routes.leave.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:t("routes.leave.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:t("routes.leave.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:t("routes.leave.action"),key:"action",align:"center",slots:{customRender:"action"}}],De=ve({components:{FormSearch:de,BaseForm:ue},setup(){const e=U(()=>ie().loading),n=C([]),r=C([]),D=C(),o=w({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),K=w([{type:"input",label:t("routes.leave.nickName"),name:"nickName",value:"",placeholder:t("routes.leave.nickNamePlaceholder")},{type:"select",label:t("routes.leave.status"),name:"status",value:void 0,placeholder:t("routes.leave.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:r},{type:"select",label:t("routes.leave.leaveType"),name:"type",value:void 0,placeholder:t("routes.leave.leaveTypePlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:n}]),F=a=>{u.value.current=1,o.pageNum=u.value.current,o.nickName=a.nickName,o.type=a.type,o.status=a.status,v(o)},p=C([]),u=C({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:a=>`\u5171 ${a} \u6761`}),y=C(),b=w({selectedRowKeys:[]}),N=U(()=>b.selectedRowKeys.length>0),j=a=>{console.log("selectedRowKeys changed: ",a),b.selectedRowKeys=a},E=a=>{y.value=a},O=async({key:a})=>{console.log(a,y),y.value&&(await Q(y.value.id).then(i=>{Object.keys(l).forEach(f=>{l[f]=i.data[f]})}),l.status=a,G(l).then(i=>{L.success(i.message),v(o)}))},B=a=>{u.value=a,o.pageNum=u.value.current,o.pageSize=u.value.pageSize,v(o)},v=a=>{Te(a).then(i=>{console.log(i),p.value=i.data.rows,u.value.total=i.data.count,b.selectedRowKeys=[]})},k=()=>{A.value=!0,I.value=t("common.add")},d=a=>{Q(a.id).then(i=>{A.value=!0,I.value=t("common.update"),V(()=>{Object.keys(l).forEach(f=>{l[f]=i.data[f],l.time=["",""],f==="startTime"&&V(()=>{l.time[0]=i.data[f]}),f==="endTime"&&V(()=>{l.time[1]=i.data[f]})})})})},g=a=>{const i=a.id||b.selectedRowKeys;Ae(i).then(()=>{(i.length&&i.length===p.value.length||p.value.length===1)&&Math.ceil(u.value.total/o.pageSize)===o.pageNum&&o.pageNum>1&&o.pageNum--,v(o),L.success(t("common.deleteSuccess"))})},X=a=>{console.log(a),L.success(t("common.cancelDelete"))},{open:A,drawerTitle:I}=me(),l=w({id:void 0,leaveDate:"",type:void 0,leaveReason:void 0,time:[],startTime:"",endTime:""}),z=a=>{l.startTime=a[0],l.endTime=a[1]},J=w({time:[{required:!0,message:t("routes.leave.startTimePlaceholder")}],type:[{required:!0,message:t("routes.leave.endTimePlaceholder")}]}),W=w([{name:"time",label:t("routes.leave.selectTime"),type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:[t("routes.leave.startTime"),t("routes.leave.endTime")],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:z,change:z}},{name:"type",label:t("routes.leave.leaveType"),type:"select",value:void 0,span:24,placeholder:t("routes.leave.leaveTypePlaceholder"),options:n,serialize:{value:"dictValue",label:"dictLabel"}},{name:"leaveReason",label:t("routes.leave.leaveReason"),type:"textarea",value:void 0,span:24,placeholder:t("routes.leave.leaveReasonPlaceholder")}]),Z=()=>{console.log(l),l.id?G(l).then(a=>{L.success(a.message),v(o),l.id=void 0,D.value.resetFields(),A.value=!1}):Ce(l).then(a=>{L.success(a.message),v(o),l.id=void 0,D.value.resetFields(),A.value=!1})},ee=()=>{l.id=void 0,D.value.resetFields(),A.value=!1},ae=()=>{v(o)};return fe(async()=>{n.value=await H("sys_leave_type"),r.value=await H("sys_examineAndApprove_status"),n.value.forEach(a=>{a.value=a.dictValue,a.lable=a.dictLabel}),r.value.forEach(a=>{a.value=a.dictValue,a.lable=a.dictLabel}),ae()}),x($({t,loading:e,queryParams:o,formFields:K,handleQuery:F,tableList:p,columns:we,pagination:u,hasSelected:N,handleTableChange:B,selectDictLabel:ce,confirm:g,cancel:X,onSelectChange:j},he(b)),{handleExamineAndApprove:O,handleClickDropdown:E,BaseFormRef:D,open:A,drawerTitle:I,leaveTypeOptions:n,examineAndApproveStatusOptions:r,formState:l,rules:J,formDataObj:W,handleClose:ee,onOkTime:z,handleAdd:k,handleUpdate:d,handleSubmit:Z})}}),Se={class:"p-4"},Re={class:"mb-3"},_e={class:"mr-3 text-[#faad14] cursor-pointer"};function Le(e,n,r,D,o,K){const F=m("form-search"),p=m("a-button"),u=m("a-col"),y=m("a-popconfirm"),b=m("a-row"),N=m("a-menu-item"),j=m("a-menu"),E=m("a-dropdown"),O=m("a-table"),B=m("BaseForm"),v=m("a-drawer"),k=ge("has-permi");return P(),q("div",Se,[T("div",Re,[c(F,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),c(b,{gutter:10,class:"mb-2"},{default:s(()=>[R(c(u,null,{default:s(()=>[c(p,{color:"success",onClick:e.handleAdd},{default:s(()=>[_(h(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[k,["examineAndApprove:leave:add"]]]),R(c(u,null,{default:s(()=>[c(y,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:s(()=>[c(p,{disabled:!e.hasSelected,color:"error"},{default:s(()=>[_(h(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[k,["examineAndApprove:leave:delete"]]])]),_:1}),c(O,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:s(({record:d})=>[T("span",null,h(d.user.nickName),1)]),type:s(({record:d})=>[T("span",null,h(e.selectDictLabel(e.leaveTypeOptions,d.type)),1)]),status:s(({record:d})=>[T("span",null,h(e.selectDictLabel(e.examineAndApproveStatusOptions,d.status)),1)]),action:s(({record:d})=>[T("span",null,[R(T("span",null,[c(E,{trigger:["click"],onClick:g=>e.handleClickDropdown(d)},{overlay:s(()=>[c(j,{onClick:e.handleExamineAndApprove},{default:s(()=>[(P(!0),q(ye,null,be(e.examineAndApproveStatusOptions,g=>(P(),ke(N,{disabled:g.dictValue==="0",key:g.dictValue},{default:s(()=>[_(h(g.dictLabel),1)]),_:2},1032,["disabled"]))),128))]),_:1},8,["onClick"])]),default:s(()=>[T("span",_e,h(e.t("routes.leave.approve")),1)]),_:2},1032,["onClick"])],512),[[k,["examineAndApprove:leave:update"]]]),R(c(p,{type:"link",color:"success",class:"mr-3",onClick:g=>e.handleUpdate(d)},{default:s(()=>[_(h(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[k,["examineAndApprove:leave:update"]]]),c(y,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:g=>e.confirm(d),onCancel:e.cancel},{default:s(()=>[R(c(p,{type:"link",color:"error"},{default:s(()=>[_(h(e.t("common.delete")),1)]),_:1},512),[[k,["examineAndApprove:leave:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),c(v,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":n[0]||(n[0]=d=>e.open=d),maskClosable:!1,onClose:e.handleClose},{default:s(()=>[c(B,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var Pe=re(De,[["render",Le]]);export{Pe as default};
