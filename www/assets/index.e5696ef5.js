var W=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var $=(e,a,c)=>a in e?W(e,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):e[a]=c,A=(e,a)=>{for(var c in a||(a={}))x.call(a,c)&&$(e,c,a[c]);if(j)for(var c of j(a))ee.call(a,c)&&$(e,c,a[c]);return e},q=(e,a)=>Y(e,Z(a));import{H as _,_ as te,a as oe}from"./index.da4ff793.js";import{g as K,s as ne}from"./dictFormat.31da75fc.js";import{u as ae}from"./useDrawer.8b3a90cf.js";import{F as le}from"./index.ab3e0a2d.js";import{u as se}from"./useI18n.25a437e0.js";import{d as ie,c as M,r as w,a as D,f as ce,a6 as re,q as r,a3 as ue,t as F,y as Q,z as L,k as o,x as n,a4 as B,S as C,R as g,v as G,F as de,X as me,D as pe,M as E,n as fe}from"./ant-design-vue.27440fdb.js";function ge(e={}){return _("/admin/system/notice","GET",e)}function ye(e){return _("/admin/system/notice/"+e,"GET",{},!1)}function ve(e){return _("/admin/system/notice/"+e,"DELETE")}function he(e={}){return _("/admin/system/notice","POST",e)}function Te(e){return _("/admin/system/notice/"+e.id,"PUT",e)}const{t:s}=se(),be=[{title:s("routes.notice.noticeTitle"),dataIndex:"noticeTitle",key:"noticeTitle",align:"center"},{title:s("routes.notice.noticeType"),dataIndex:"noticeType",key:"noticeType",align:"center",slots:{customRender:"noticeType"}},{title:s("routes.notice.noticeContent"),dataIndex:"noticeContent",key:"noticeContent",align:"center"},{title:s("routes.notice.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:s("routes.notice.createdBy"),dataIndex:"createdBy",key:"createdBy",align:"center"},{title:s("routes.notice.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:s("routes.notice.action"),key:"action",align:"center",slots:{customRender:"action"}}],Ce=ie({components:{FormSearch:le},setup(){const e=M(()=>oe().loading),a=w([]),c=w([]),R=w([]),P={noticeTitle:[{required:!0,message:s("routes.notice.noticeTitleCannotBeEmpty"),trigger:"blur"}],noticeType:[{required:!0,message:s("routes.notice.noticeTypeCannotBeEmpty"),trigger:"blur"}],status:[{required:!0,message:s("routes.notice.statusCannotBeEmpty"),trigger:"change"}]},U=D([{type:"input",label:s("routes.notice.noticeTitle"),name:"noticeTitle",value:"",placeholder:s("routes.notice.noticeTitlePlaceholder")},{type:"select",label:s("routes.notice.noticeType"),name:"noticeType",value:void 0,placeholder:s("routes.notice.noticeTypePlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:R},{type:"select",label:s("routes.notice.status"),name:"status",value:void 0,placeholder:s("routes.notice.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:a}]),i=D({pageNum:1,pageSize:10,noticeTitle:"",noticeType:"",status:""}),y=t=>{m.value.current=1,i.pageNum=m.value.current,i.noticeTitle=t.noticeTitle,i.noticeType=t.noticeType,i.status=t.status,v(i)},u=w([]),m=w({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:t=>`\u5171 ${t} \u6761`}),N=t=>{m.value=t,i.pageNum=m.value.current,i.pageSize=m.value.pageSize,v(i)},T=D({selectedRowKeys:[]}),z=M(()=>T.selectedRowKeys.length>0),b=t=>{console.log("selectedRowKeys changed: ",t),T.selectedRowKeys=t},v=t=>{ge(t).then(f=>{console.log(f),u.value=f.data.rows,m.value.total=f.data.count,T.selectedRowKeys=[]})},I=()=>{v(i)},h=w(),d=D({id:void 0,noticeTitle:void 0,noticeType:void 0,status:"1",noticeContent:void 0}),{open:p,drawerTitle:S}=ae();console.log(p);const k=()=>{d.id=void 0,h.value.resetFields(),console.log(h),p.value=!1},l=()=>{console.log(d),h.value.validate().then(()=>{d.id?Te(d).then(t=>{E.success(t.message),v(i),d.id=void 0,h.value.resetFields(),p.value=!1}):he(d).then(t=>{E.success(t.message),v(i),d.id=void 0,h.value.resetFields(),p.value=!1})}).catch(t=>{console.log("error",t)})},O=t=>{const f=t.id||T.selectedRowKeys;ve(f).then(()=>{(f.length&&f.length===u.value.length||u.value.length===1)&&Math.ceil(m.value.total/i.pageSize)===i.pageNum&&i.pageNum>1&&i.pageNum--,v(i),E.success(s("common.deleteSuccess"))})},H=t=>{console.log(t),E.success(s("common.cancelDelete"))},X=()=>{p.value=!0,S.value=s("common.add")},J=t=>{ye(t.id).then(f=>{p.value=!0,S.value=s("common.update"),fe(()=>{Object.keys(d).forEach(V=>{d[V]=f.data[V]})})})};return ce(async()=>{a.value=await K("sys_normal_disable"),R.value=await K("sys_notice_type"),c.value=await K("sys_normal_disable"),c.value.forEach(t=>{t.label=t.dictLabel,t.value=t.dictValue}),I()}),q(A({t:s,loading:e,queryParams:i,formFields:U,handleQuery:y,noticeList:u,columns:be,pagination:m,handleTableChange:N,selectDictLabel:ne,statusOptions:a,typeOptions:R},re(T)),{hasSelected:z,onSelectChange:b,open:p,drawerTitle:S,formState:d,labelCol:{span:4},wrapperCol:{span:18},rules:P,formRef:h,handleClose:k,handleSubmit:l,confirm:O,cancel:H,handleAdd:X,handleUpdate:J,disableOptions:c})}}),ke={class:"p-4"},we={class:"mb-3"};function Se(e,a,c,R,P,U){const i=r("form-search"),y=r("a-button"),u=r("a-col"),m=r("a-popconfirm"),N=r("a-row"),T=r("a-table"),z=r("a-input"),b=r("a-form-item"),v=r("a-select-option"),I=r("a-select"),h=r("a-radio-group"),d=r("a-textarea"),p=r("a-form"),S=r("a-drawer"),k=ue("has-permi");return F(),Q("div",ke,[L("div",we,[o(i,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),o(N,{gutter:10,class:"mb-2"},{default:n(()=>[B(o(u,null,{default:n(()=>[o(y,{color:"success",onClick:e.handleAdd},{default:n(()=>[C(g(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[k,["system:notice:add"]]]),B(o(u,null,{default:n(()=>[o(m,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:n(()=>[o(y,{disabled:!e.hasSelected,color:"error"},{default:n(()=>[C(g(e.t("common.update")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[k,["system:notice:delete"]]])]),_:1}),o(T,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.noticeList,pagination:e.pagination,onChange:e.handleTableChange},{status:n(({record:l})=>[L("span",null,g(e.selectDictLabel(e.statusOptions,l.status)),1)]),noticeType:n(({record:l})=>[L("span",null,g(e.selectDictLabel(e.typeOptions,l.noticeType)),1)]),action:n(({record:l})=>[L("span",null,[B(o(y,{type:"link",color:"success",class:"mr-3",onClick:O=>e.handleUpdate(l)},{default:n(()=>[C(g(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[k,["system:notice:update"]]]),o(m,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:O=>e.confirm(l),onCancel:e.cancel},{default:n(()=>[B(o(y,{type:"link",color:"error"},{default:n(()=>[C(g(e.t("common.delete")),1)]),_:1},512),[[k,["system:notice:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),o(S,{width:"600px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[4]||(a[4]=l=>e.open=l),maskClosable:!1,onClose:e.handleClose},{default:n(()=>[e.open?(F(),G(p,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:n(()=>[o(N,null,{default:n(()=>[o(u,{span:24},{default:n(()=>[o(b,{label:e.t("routes.notice.noticeTitle"),name:"noticeTitle"},{default:n(()=>[o(z,{value:e.formState.noticeTitle,"onUpdate:value":a[0]||(a[0]=l=>e.formState.noticeTitle=l),placeholder:e.t("routes.notice.noticeTitle")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(u,{span:24},{default:n(()=>[o(b,{label:e.t("routes.notice.noticeType"),name:"noticeType"},{default:n(()=>[o(I,{value:e.formState.noticeType,"onUpdate:value":a[1]||(a[1]=l=>e.formState.noticeType=l),placeholder:e.t("routes.notice.noticeTypePlaceholder")},{default:n(()=>[(F(!0),Q(de,null,me(e.typeOptions,l=>(F(),G(v,{key:l.id,value:l.dictValue},{default:n(()=>[C(g(l.dictLabel),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(u,{span:24},{default:n(()=>[o(b,{label:e.t("routes.notice.status"),name:"status"},{default:n(()=>[o(h,{value:e.formState.status,"onUpdate:value":a[2]||(a[2]=l=>e.formState.status=l),options:e.disableOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),o(u,{span:24},{default:n(()=>[o(b,{label:e.t("routes.notice.noticeContent"),name:"noticeContent"},{default:n(()=>[o(d,{rows:3,value:e.formState.noticeContent,"onUpdate:value":a[3]||(a[3]=l=>e.formState.noticeContent=l),placeholder:e.t("routes.notice.noticeContentPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(u,{span:24},{default:n(()=>[o(b,null,{default:n(()=>[o(y,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:n(()=>[C(g(e.t("common.okText")),1)]),_:1},8,["onClick"]),o(y,{onClick:e.handleClose},{default:n(()=>[C(g(e.t("common.cancelText")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","label-col","wrapper-col"])):pe("",!0)]),_:1},8,["title","visible","onClose"])])}var Ee=te(Ce,[["render",Se]]);export{Ee as default};
