var ee=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var x=(e,t,i)=>t in e?ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,P=(e,t)=>{for(var i in t||(t={}))te.call(t,i)&&x(e,i,t[i]);if($)for(var i of $(t))ne.call(t,i)&&x(e,i,t[i]);return e},V=(e,t)=>oe(e,ae(t));import{H as C,_ as re,a as se}from"./index.da4ff793.js";import{g as ie,s as le}from"./dictFormat.31da75fc.js";import{F as me}from"./index.ab3e0a2d.js";import{B as ce}from"./index.7fa8a761.js";import{u as de}from"./useDrawer.8b3a90cf.js";import{u as ue}from"./useI18n.25a437e0.js";import{d as pe,c as H,r as y,a as b,f as ve,a6 as ke,q as u,a3 as fe,t as z,y as W,z as A,k as m,x as s,a4 as D,S,R as T,F as Te,X as we,v as he,M as R,n as K}from"./ant-design-vue.27440fdb.js";function ge(e={}){return C("/admin/examineAndApprove/workOverTime","GET",e)}function U(e){return C("/admin/examineAndApprove/workOverTime/"+e,"GET",{},!1)}function Oe(e){return C("/admin/examineAndApprove/workOverTime/"+e,"DELETE")}function be(e={}){return C("/admin/examineAndApprove/workOverTime","POST",e)}function q(e){return C("/admin/examineAndApprove/workOverTime/"+e.id,"PUT",e)}const{t:a}=ue(),Ae=[{title:a("routes.workOverTime.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:a("routes.workOverTime.workOverTimeDuration"),dataIndex:"workOverTimeDuration",key:"workOverTimeDuration",align:"center",slots:{customRender:"workOverTimeDuration"}},{title:a("routes.workOverTime.workOverTimeReason"),dataIndex:"workOverTimeReason",key:"workOverTimeReason",align:"center"},{title:a("routes.workOverTime.startTime"),dataIndex:"startTime",key:"startTime",align:"center"},{title:a("routes.workOverTime.endTime"),dataIndex:"endTime",key:"endTime",align:"center"},{title:a("routes.workOverTime.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:a("routes.workOverTime.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:a("routes.workOverTime.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:a("routes.workOverTime.action"),key:"action",align:"center",slots:{customRender:"action"}}],Ce=pe({components:{FormSearch:me,BaseForm:ce},setup(){const e=H(()=>se().loading),t=y([]),i=y(),r=b({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),M=b([{type:"input",label:a("routes.workOverTime.nickName"),name:"nickName",value:"",placeholder:a("routes.workOverTime.nickNamePlaceholder")},{type:"select",label:a("routes.workOverTime.status"),name:"status",value:void 0,placeholder:a("routes.workOverTime.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:t}]),Y=o=>{c.value.current=1,r.pageNum=c.value.current,r.nickName=o.nickName,r.status=o.status,p(r)},g=y([]),c=y({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:o=>`\u5171 ${o} \u6761`}),w=y(),k=b({selectedRowKeys:[]}),_=H(()=>k.selectedRowKeys.length>0),F=o=>{console.log("selectedRowKeys changed: ",o),k.selectedRowKeys=o},N=o=>{w.value=o},j=async({key:o})=>{console.log(o,w),w.value&&(await U(w.value.id).then(l=>{Object.keys(n).forEach(v=>{n[v]=l.data[v]})}),n.status=o,q(n).then(l=>{R.success(l.message),p(r)}))},B=o=>{c.value=o,r.pageNum=c.value.current,r.pageSize=c.value.pageSize,p(r)},p=o=>{ge(o).then(l=>{console.log(l),g.value=l.data.rows,c.value.total=l.data.count,k.selectedRowKeys=[]})},E=()=>{O.value=!0,I.value=a("common.add")},h=o=>{U(o.id).then(l=>{O.value=!0,I.value=a("common.update"),K(()=>{Object.keys(n).forEach(v=>{n[v]=l.data[v],n.time=["",""],v==="startTime"&&K(()=>{n.time[0]=l.data[v]}),v==="endTime"&&K(()=>{n.time[1]=l.data[v]})})})})},d=o=>{const l=o.id||k.selectedRowKeys;Oe(l).then(()=>{(l.length&&l.length===g.value.length||g.value.length===1)&&Math.ceil(c.value.total/r.pageSize)===r.pageNum&&r.pageNum>1&&r.pageNum--,p(r),R.success(a("common.deleteSuccess"))})},f=o=>{console.log(o),R.success(a("common.cancelDelete"))},{open:O,drawerTitle:I}=de(),n=b({id:void 0,type:void 0,workOverTimeReason:void 0,time:[],startTime:"",endTime:""}),Q=b({time:[{required:!0,message:a("routes.workOverTime.startTimePlaceholder")}]}),L=o=>{n.startTime=o[0],n.endTime=o[1]},G=b([{name:"time",label:a("routes.workOverTime.selectTime"),type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:[a("routes.workOverTime.startTime"),a("routes.workOverTime.endTime")],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:L,change:L}},{name:"workOverTimeReason",label:a("routes.workOverTime.workOverTimeReason"),type:"textarea",value:void 0,span:24,placeholder:a("routes.workOverTime.workOverTimeReasonPlaceholder")}]),X=()=>{console.log(n),n.id?q(n).then(o=>{R.success(o.message),p(r),n.id=void 0,i.value.resetFields(),O.value=!1}):be(n).then(o=>{R.success(o.message),p(r),n.id=void 0,i.value.resetFields(),O.value=!1})},J=()=>{n.id=void 0,i.value.resetFields(),O.value=!1},Z=()=>{p(r)};return ve(async()=>{t.value=await ie("sys_examineAndApprove_status"),t.value.forEach(o=>{o.value=o.dictValue,o.lable=o.dictLabel}),Z()}),V(P({t:a,loading:e,queryParams:r,formFields:M,handleQuery:Y,tableList:g,columns:Ae,pagination:c,hasSelected:_,handleTableChange:B,selectDictLabel:le,confirm:d,cancel:f,onSelectChange:F},ke(k)),{handleExamineAndApprove:j,handleClickDropdown:N,BaseFormRef:i,open:O,drawerTitle:I,examineAndApproveStatusOptions:t,formState:n,formDataObj:G,rules:Q,handleClose:J,handleAdd:E,onOkTime:L,handleUpdate:h,handleSubmit:X})}}),ye={class:"p-4"},De={class:"mb-3"},Se={class:"mr-3 text-[#faad14] cursor-pointer"};function Re(e,t,i,r,M,Y){const g=u("form-search"),c=u("a-button"),w=u("a-col"),k=u("a-popconfirm"),_=u("a-row"),F=u("a-menu-item"),N=u("a-menu"),j=u("a-dropdown"),B=u("a-table"),p=u("BaseForm"),E=u("a-drawer"),h=fe("has-permi");return z(),W("div",ye,[A("div",De,[m(g,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),m(_,{gutter:10,class:"mb-2"},{default:s(()=>[D(m(w,null,{default:s(()=>[m(c,{color:"success",onClick:e.handleAdd},{default:s(()=>[S(T(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[h,["examineAndApprove:workOverTime:add"]]]),D(m(w,null,{default:s(()=>[m(k,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:s(()=>[m(c,{disabled:!e.hasSelected,color:"error"},{default:s(()=>[S(T(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[h,["examineAndApprove:workOverTime:delete"]]])]),_:1}),m(B,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:s(({record:d})=>[A("span",null,T(d.user.nickName),1)]),status:s(({record:d})=>[A("span",null,T(e.selectDictLabel(e.examineAndApproveStatusOptions,d.status)),1)]),action:s(({record:d})=>[A("span",null,[D(A("span",null,[m(j,{trigger:["click"],onClick:f=>e.handleClickDropdown(d)},{overlay:s(()=>[m(N,{onClick:e.handleExamineAndApprove},{default:s(()=>[(z(!0),W(Te,null,we(e.examineAndApproveStatusOptions,f=>(z(),he(F,{disabled:f.dictValue==="0",key:f.dictValue},{default:s(()=>[S(T(f.dictLabel),1)]),_:2},1032,["disabled"]))),128))]),_:1},8,["onClick"])]),default:s(()=>[A("span",Se,T(e.t("routes.workOverTime.approve")),1)]),_:2},1032,["onClick"])],512),[[h,["examineAndApprove:workOverTime:update"]]]),D(m(c,{type:"link",color:"success",class:"mr-3",onClick:f=>e.handleUpdate(d)},{default:s(()=>[S(T(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[h,["examineAndApprove:workOverTime:update"]]]),m(k,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:f=>e.confirm(d),onCancel:e.cancel},{default:s(()=>[D(m(c,{type:"link",color:"error"},{default:s(()=>[S(T(e.t("common.delete")),1)]),_:1},512),[[h,["examineAndApprove:workOverTime:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),m(E,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":t[0]||(t[0]=d=>e.open=d),maskClosable:!1,onClose:e.handleClose},{default:s(()=>[m(p,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var ze=re(Ce,[["render",Re]]);export{ze as default};
