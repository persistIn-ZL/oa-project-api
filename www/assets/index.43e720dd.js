var q=Object.defineProperty,H=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var O=(e,s,n)=>s in e?q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,F=(e,s)=>{for(var n in s||(s={}))U.call(s,n)&&O(e,n,s[n]);if(N)for(var n of N(s))J.call(s,n)&&O(e,n,s[n]);return e},z=(e,s)=>H(e,G(s));import{H as j,_ as W,a as X,o as Y}from"./index.da4ff793.js";import{g as Z,s as x}from"./dictFormat.31da75fc.js";import{F as ee}from"./index.ab3e0a2d.js";import{u as oe}from"./useDrawer.8b3a90cf.js";import{u as te}from"./useI18n.25a437e0.js";import{d as se,c as I,r as C,a as D,f as ae,a6 as le,q as p,a3 as ne,t as K,y as $,z as m,k as r,x as i,S as b,R as o,a4 as B,D as ce,M as A}from"./ant-design-vue.27440fdb.js";function re(e={}){return j("/admin/system/logs","GET",e)}function ie(e){return j("/admin/system/logs/"+e,"DELETE")}function de(){return j("/admin/system/logs/deleteAllLogs","DELETE")}const{t:a}=te(),me=[{title:a("routes.logs.createdBy"),dataIndex:"createdBy",key:"createdBy",align:"center"},{title:a("routes.logs.url"),dataIndex:"url",key:"url",align:"center"},{title:a("routes.logs.method"),dataIndex:"method",key:"method",align:"center"},{title:a("routes.logs.ip"),dataIndex:"ip",key:"ip",align:"center"},{title:a("routes.logs.status"),dataIndex:"status",key:"status",align:"center"},{title:a("routes.logs.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:a("routes.logs.action"),key:"action",align:"center",slots:{customRender:"action"}}],ue=se({components:{FormSearch:ee},setup(){const e=X(),s=I(()=>e.loading),n=C([]),l=D({pageNum:1,pageSize:10,createdBy:"",method:""}),L=D([{type:"input",label:a("routes.logs.createdBy"),name:"createdBy",value:"",placeholder:a("routes.logs.createdByPlaceholder")},{type:"select",label:a("routes.logs.method"),name:"method",value:void 0,placeholder:a("routes.logs.methodPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:n}]),R=t=>{c.value.current=1,l.pageNum=c.value.current,l.createdBy=t.createdBy,l.method=t.method,u(l)},h=C([]),c=C({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:t=>`\u5171 ${t} \u6761`}),d=D({selectedRowKeys:[]}),v=I(()=>d.selectedRowKeys.length>0),w=t=>{console.log("selectedRowKeys changed: ",t),d.selectedRowKeys=t},k=t=>{c.value=t,l.pageNum=c.value.current,l.pageSize=c.value.pageSize,u(l)},u=t=>{re(t).then(g=>{console.log(g),h.value=g.data.rows,c.value.total=g.data.count,d.selectedRowKeys=[]})},y=()=>{Y("/admin/system/logs/export",{},`${a("routes.logs.logs")}.xlsx`)},f=t=>{const g=t.id||d.selectedRowKeys;ie(g).then(()=>{(g.length&&g.length===h.value.length||h.value.length===1)&&Math.ceil(c.value.total/l.pageSize)===l.pageNum&&l.pageNum>1&&l.pageNum--,u(l),A.success(a("common.deleteSuccess"))})},S=t=>{console.log(t),A.success(a("common.cancelDelete"))},V=()=>{de().then(()=>{u(l),A.success(a("routes.logs.clearAllSuccess"))})},{open:_,drawerTitle:T}=oe(),E=C(),M=t=>{_.value=!0,T.value=a("common.detail"),E.value=t,console.log(t)},P=()=>{_.value=!1},Q=()=>{u(l)};return ae(async()=>{n.value=await Z("sys_method_type"),Q()}),z(F({t:a,loading:s,queryParams:l,formFields:L,handleQuery:R,logsList:h,columns:me,pagination:c,hasSelected:v,methodOptions:n,handleExportFile:y,clearAll:V,handleTableChange:k,selectDictLabel:x,confirm:f,cancel:S,onSelectChange:w},le(d)),{open:_,drawerTitle:T,detailObj:E,handleClose:P,showDetail:M})}}),ge={class:"p-4"},pe={class:"mb-3"},he={key:0},fe={class:"mb-2"},ye={class:"mb-2"},be={class:"mb-2"},ve={class:"mb-2"},Ce={class:"mb-2"},we={class:"mb-2"},ke={class:"mb-2"};function Se(e,s,n,l,L,R){const h=p("form-search"),c=p("a-button"),d=p("a-col"),v=p("a-popconfirm"),w=p("a-row"),k=p("a-table"),u=p("a-drawer"),y=ne("has-permi");return K(),$("div",ge,[m("div",pe,[r(h,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),r(w,{gutter:10,class:"mb-2"},{default:i(()=>[r(d,null,{default:i(()=>[r(c,{color:"normal",onClick:e.handleExportFile},{default:i(()=>[b(o(e.t("common.export")),1)]),_:1},8,["onClick"])]),_:1}),B(r(d,null,{default:i(()=>[r(c,{color:"warning",onClick:e.clearAll},{default:i(()=>[b(o(e.t("common.clearAll")),1)]),_:1},8,["onClick"])]),_:1},512),[[y,["system:logs:deleteAllLogs"]]]),B(r(d,null,{default:i(()=>[r(v,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:i(()=>[r(c,{disabled:!e.hasSelected,color:"error"},{default:i(()=>[b(o(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[y,["system:logs:delete"]]])]),_:1}),r(k,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.logsList,pagination:e.pagination,onChange:e.handleTableChange},{action:i(({record:f})=>[m("span",null,[r(c,{type:"link",color:"success",class:"mr-3",onClick:S=>e.showDetail(f)},{default:i(()=>[b(o(e.t("common.detail")),1)]),_:2},1032,["onClick"]),r(v,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:S=>e.confirm(f),onCancel:e.cancel},{default:i(()=>[B(r(c,{type:"link",color:"error"},{default:i(()=>[b(o(e.t("common.delete")),1)]),_:1},512),[[y,["system:logs:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),r(u,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":s[0]||(s[0]=f=>e.open=f),maskClosable:!1,onClose:e.handleClose},{default:i(()=>[e.detailObj?(K(),$("div",he,[m("p",fe,o(e.t("routes.logs.createdBy"))+": "+o(e.detailObj.createdBy),1),m("p",ye,o(e.t("routes.logs.url"))+": "+o(e.detailObj.url),1),m("p",be,o(e.t("routes.logs.ip"))+": "+o(e.detailObj.ip),1),m("p",ve,o(e.t("routes.logs.method"))+": "+o(e.detailObj.method),1),m("p",Ce,o(e.t("routes.logs.status"))+": "+o(e.detailObj.status),1),m("p",we,o(e.t("routes.logs.data"))+": "+o(e.detailObj.data),1),m("p",ke,o(e.t("routes.logs.createdAt"))+": "+o(e.detailObj.createdAt),1)])):ce("",!0)]),_:1},8,["title","visible","onClose"])])}var Te=W(ue,[["render",Se]]);export{Te as default};
