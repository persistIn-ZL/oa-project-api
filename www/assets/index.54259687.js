var W=Object.defineProperty,U=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var H=(e,l,a)=>l in e?W(e,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[l]=a,z=(e,l)=>{for(var a in l||(l={}))Q.call(l,a)&&H(e,a,l[a]);if(j)for(var a of j(l))G.call(l,a)&&H(e,a,l[a]);return e},L=(e,l)=>U(e,q(l));import{H as y,_ as J,a as X}from"./index.da4ff793.js";import{g as Z,s as x}from"./dictFormat.31da75fc.js";import{B as ee}from"./index.7fa8a761.js";import{F as oe}from"./index.ab3e0a2d.js";import{u as ne}from"./useDrawer.8b3a90cf.js";import{u as le}from"./useI18n.25a437e0.js";import{d as te,c as E,r as C,a as v,f as ae,a6 as ce,q as k,a3 as se,t as ie,y as re,z as T,k as s,x as i,a4 as w,S,R as g,n as de,M as F}from"./ant-design-vue.27440fdb.js";function ue(e={}){return y("/admin/baseInfo/clockIn","GET",e)}function me(e){return y("/admin/baseInfo/clockIn/"+e,"GET",{},!1)}function pe(e){return y("/admin/baseInfo/clockIn/"+e,"DELETE")}function ke(e={}){return y("/admin/baseInfo/clockIn","POST",e)}function fe(e){return y("/admin/baseInfo/clockIn/"+e.id,"PUT",e)}const{t:o}=le(),Ie=[{title:o("routes.clockIn.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:o("routes.clockIn.clockInType"),key:"type",align:"center",slots:{customRender:"type"}},{title:o("routes.clockIn.clockInWiFi"),dataIndex:"wifiBefore",key:"wifiBefore",align:"center"},{title:o("routes.clockIn.clockInAddr"),dataIndex:"firstClockInAddr",key:"firstClockInAddr",align:"center"},{title:o("routes.clockIn.clockInTime"),dataIndex:"firstClockInTime",key:"firstClockInTime",align:"center"},{title:o("routes.clockIn.clockOutWiFi"),dataIndex:"wifiNext",key:"wifiNext",align:"center"},{title:o("routes.clockIn.clockOutAddr"),dataIndex:"lastClockInAddr",key:"lastClockInAddr",align:"center"},{title:o("routes.clockIn.clockOutTime"),dataIndex:"lastClockInTime",key:"lastClockInTime",align:"center"},{title:o("routes.clockIn.action"),key:"action",align:"center",slots:{customRender:"action"}}],he=te({components:{FormSearch:oe,BaseForm:ee},setup(){const e=E(()=>X().loading),l=C([]),a=C(),t=v({pageNum:1,pageSize:10,nickName:"",type:""}),B=v([{type:"input",label:o("routes.clockIn.nickName"),name:"nickName",value:"",placeholder:o("routes.clockIn.nickNamePlaceholder")},{type:"select",label:o("routes.clockIn.clockInType"),name:"type",value:void 0,placeholder:o("routes.clockIn.clockInTypePlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:l}]),_=n=>{c.value.current=1,t.pageNum=c.value.current,t.nickName=n.nickName,t.type=n.type,p(t)},f=C([]),c=C({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:n=>`\u5171 ${n} \u6761`}),m=v({selectedRowKeys:[]}),b=E(()=>m.selectedRowKeys.length>0),N=n=>{console.log("selectedRowKeys changed: ",n),m.selectedRowKeys=n},D=n=>{c.value=n,t.pageNum=c.value.current,t.pageSize=c.value.pageSize,p(t)},p=n=>{ue(n).then(u=>{console.log(u),f.value=u.data.rows,c.value.total=u.data.count,m.selectedRowKeys=[]})},A=()=>{h.value=!0,O.value=o("common.add")},I=n=>{me(n.id).then(u=>{h.value=!0,O.value=o("common.update"),de(()=>{Object.keys(d).forEach(P=>{d[P]=u.data[P]}),console.log(d)})})},r=n=>{const u=n.id||m.selectedRowKeys;pe(u).then(()=>{(u.length&&u.length===f.value.length||f.value.length===1)&&Math.ceil(c.value.total/t.pageSize)===t.pageNum&&t.pageNum>1&&t.pageNum--,p(t),F.success(o("common.deleteSuccess"))})},R=n=>{console.log(n),F.success(o("common.cancelDelete"))},{open:h,drawerTitle:O}=ne(),K=v({type:[{required:!0,message:o("routes.clockIn.clockInTypePlaceholder")}]}),M=v([{name:"type",label:o("routes.clockIn.clockInType"),type:"select",value:void 0,span:24,placeholder:o("routes.clockIn.clockInTypePlaceholder"),options:l,serialize:{value:"dictValue",label:"dictLabel"}},{name:"wifiBefore",label:o("routes.clockIn.clockInWiFi"),type:"input",value:void 0,span:24,placeholder:o("routes.clockIn.clockInWiFiPlaceholder")},{name:"firstClockInAddr",label:o("routes.clockIn.clockInAddr"),type:"input",span:24,value:void 0,placeholder:o("routes.clockIn.clockInAddrPlaceholder")},{name:"firstClockInTime",label:o("routes.clockIn.clockInTime"),type:"time-picker",span:24,value:void 0,placeholder:o("routes.clockIn.clockInTime"),props:{valueFormat:"YYYY-MM-DD HH:mm",format:"HH:mm"}},{name:"wifiNext",label:o("routes.clockIn.clockOutWiFi"),type:"input",value:void 0,span:24,placeholder:o("routes.clockIn.clockOutWiFiPlaceholder")},{name:"lastClockInAddr",label:o("routes.clockIn.clockOutAddr"),type:"input",span:24,value:void 0,placeholder:o("routes.clockIn.clockOutAddrPlaceholder")},{name:"lastClockInTime",label:o("routes.clockIn.clockOutTime"),type:"time-picker",span:24,value:void 0,placeholder:o("routes.clockIn.clockOutTime"),props:{valueFormat:"YYYY-MM-DD HH:mm",format:"HH:mm"}}]),d=v({id:void 0,type:"1",wifiBefore:void 0,firstClockInAddr:void 0,firstClockInTime:void 0,wifiNext:void 0,lastClockInAddr:void 0,lastClockInTime:void 0}),Y=()=>{d.id?fe(d).then(n=>{F.success(n.message),p(t),d.id=void 0,a.value.resetFields(),h.value=!1}):ke(d).then(n=>{F.success(n.message),p(t),d.id=void 0,a.value.resetFields(),h.value=!1})},$=()=>{d.id=void 0,a.value.resetFields(),h.value=!1},V=()=>{p(t)};return ae(async()=>{l.value=await Z("sys_clock_in_type"),l.value.forEach(n=>{n.value=n.dictValue,n.lable=n.dictLabel}),V()}),L(z({t:o,loading:e,queryParams:t,formFields:B,handleQuery:_,tableList:f,columns:Ie,pagination:c,hasSelected:b,handleTableChange:D,selectDictLabel:x,confirm:r,cancel:R,onSelectChange:N,handleAdd:A,handleUpdate:I},ce(m)),{BaseFormRef:a,open:h,drawerTitle:O,clockInOptions:l,formState:d,rules:K,formDataObj:M,handleClose:$,handleSubmit:Y})}}),ve={class:"p-4"},ge={class:"mb-3"};function ye(e,l,a,t,B,_){const f=k("form-search"),c=k("a-button"),m=k("a-col"),b=k("a-popconfirm"),N=k("a-row"),D=k("a-table"),p=k("BaseForm"),A=k("a-drawer"),I=se("has-permi");return ie(),re("div",ve,[T("div",ge,[s(f,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),s(N,{gutter:10,class:"mb-2"},{default:i(()=>[w(s(m,null,{default:i(()=>[s(c,{color:"success",onClick:e.handleAdd},{default:i(()=>[S(g(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[I,["baseInfo:clockIn:add"]]]),w(s(m,null,{default:i(()=>[s(b,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:i(()=>[s(c,{disabled:!e.hasSelected,color:"error"},{default:i(()=>[S(g(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[I,["baseInfo:clockIn:delete"]]])]),_:1}),s(D,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:i(({record:r})=>[T("span",null,g(r.user.nickName),1)]),type:i(({record:r})=>[T("span",null,g(e.selectDictLabel(e.clockInOptions,r.type)),1)]),action:i(({record:r})=>[T("span",null,[w(s(c,{type:"link",color:"success",class:"mr-3",onClick:R=>e.handleUpdate(r)},{default:i(()=>[S(g(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[I,["baseInfo:clockIn:update"]]]),s(b,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:R=>e.confirm(r),onCancel:e.cancel},{default:i(()=>[w(s(c,{type:"link",color:"error"},{default:i(()=>[S(g(e.t("common.delete")),1)]),_:1},512),[[I,["baseInfo:clockIn:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),s(A,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":l[0]||(l[0]=r=>e.open=r),maskClosable:!1,onClose:e.handleClose},{default:i(()=>[s(p,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var Ae=J(he,[["render",ye]]);export{Ae as default};
