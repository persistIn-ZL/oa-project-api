var ee=Object.defineProperty,ae=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var M=(e,o,r)=>o in e?ee(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,V=(e,o)=>{for(var r in o||(o={}))oe.call(o,r)&&M(e,r,o[r]);if(z)for(var r of z(o))ne.call(o,r)&&M(e,r,o[r]);return e},K=(e,o)=>ae(e,te(o));import{H as R,_ as se,a as le}from"./index.da4ff793.js";import{g as $,s as re}from"./dictFormat.31da75fc.js";import{F as de}from"./index.ab3e0a2d.js";import{u as ce}from"./useDrawer.8b3a90cf.js";import{B as ie}from"./index.7fa8a761.js";import{u as pe}from"./useI18n.25a437e0.js";import{d as ue,c as q,r as b,a as A,f as me,a6 as ke,q as m,a3 as Ce,t as O,y as x,z as f,k as c,x as l,a4 as _,S as D,R as k,F as ve,X as fe,v as he,M as T,n as ge}from"./ant-design-vue.27440fdb.js";function Ue(e={}){return R("/admin/examineAndApprove/makeUpCard","GET",e)}function Q(e){return R("/admin/examineAndApprove/makeUpCard/"+e,"GET",{},!1)}function ye(e){return R("/admin/examineAndApprove/makeUpCard/"+e,"DELETE")}function be(e={}){return R("/admin/examineAndApprove/makeUpCard","POST",e)}function G(e){return R("/admin/examineAndApprove/makeUpCard/"+e.id,"PUT",e)}const{t}=pe(),Ae=[{title:t("routes.makeUpCard.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:t("routes.makeUpCard.dateToBeSupplemented"),key:"clock_in",align:"center",slots:{customRender:"clock_in"}},{title:t("routes.makeUpCard.makeUpCardType"),dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:t("routes.makeUpCard.makeUpCardReason"),dataIndex:"makeUpCardReason",key:"makeUpCardReason",align:"center"},{title:t("routes.makeUpCard.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:t("routes.makeUpCard.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:t("routes.makeUpCard.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:t("routes.makeUpCard.action"),key:"action",align:"center",slots:{customRender:"action"}}],we=ue({components:{FormSearch:de,BaseForm:ie},setup(){const e=q(()=>le().loading),o=b([]),r=b([]),w=b(),s=A({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),P=A([{type:"input",label:t("routes.makeUpCard.nickName"),name:"nickName",value:"",placeholder:t("routes.makeUpCard.nickNamePlaceholder")},{type:"select",label:t("routes.makeUpCard.status"),name:"status",value:void 0,placeholder:t("routes.makeUpCard.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:o}]),F=a=>{p.value.current=1,s.pageNum=p.value.current,s.nickName=a.nickName,s.type=a.type,s.status=a.status,v(s)},C=b([]),p=b({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:a=>`\u5171 ${a} \u6761`}),h=b(),g=A({selectedRowKeys:[]}),I=q(()=>g.selectedRowKeys.length>0),N=a=>{console.log("selectedRowKeys changed: ",a),g.selectedRowKeys=a},L=a=>{h.value=a},j=async({key:a})=>{console.log(a,h),h.value&&(await Q(h.value.id).then(i=>{Object.keys(n).forEach(S=>{n[S]=i.data[S]})}),n.status=a,G(n).then(i=>{T.success(i.message),v(s)}))},B=a=>{p.value=a,s.pageNum=p.value.current,s.pageSize=p.value.pageSize,v(s)},v=a=>{Ue(a).then(i=>{console.log(i),C.value=i.data.rows,p.value.total=i.data.count,g.selectedRowKeys=[]})},U=()=>{y.value=!0,n.userId=void 0,n.deptId=void 0,E.value=t("common.add")},d=a=>{Q(a.id).then(i=>{y.value=!0,E.value=t("common.update"),n.userId=a.user.id,n.deptId=a.user.deptId,ge(()=>{Object.keys(n).forEach(S=>{n[S]=i.data[S]})})})},u=a=>{const i=a.id||g.selectedRowKeys;ye(i).then(()=>{(i.length&&i.length===C.value.length||C.value.length===1)&&Math.ceil(p.value.total/s.pageSize)===s.pageNum&&s.pageNum>1&&s.pageNum--,v(s),T.success(t("common.deleteSuccess"))})},H=a=>{console.log(a),T.success(t("common.cancelDelete"))},{open:y,drawerTitle:E}=ce(),n=A({id:void 0,createdAt:void 0,type:void 0,makeUpCardReason:void 0,userId:void 0,deptId:void 0}),X=A({createdAt:[{required:!0,message:t("routes.makeUpCard.createdAtPlaceholder")}],type:[{required:!0,message:t("routes.makeUpCard.makeUpCardTypePlaceholder")}]}),J=A([{name:"createdAt",label:t("routes.makeUpCard.cardRenewalDate"),type:"date-picker",value:void 0,placeholder:t("routes.makeUpCard.cardRenewalDatePlaceholder"),span:24,labelCol:8},{name:"type",label:t("routes.makeUpCard.makeUpCardType"),type:"select",value:void 0,span:24,labelCol:8,placeholder:t("routes.makeUpCard.makeUpCardTypePlaceholder"),options:r,serialize:{value:"dictValue",label:"dictLabel"}},{name:"makeUpCardReason",label:t("routes.makeUpCard.makeUpCardReason"),type:"textarea",value:void 0,span:24,labelCol:8,placeholder:t("routes.makeUpCard.makeUpCardReasonPlaceholder")}]),W=()=>{console.log(n),n.id?G(n).then(a=>{T.success(a.message),v(s),n.id=void 0,w.value.resetFields(),y.value=!1}):be(n).then(a=>{T.success(a.message),v(s),n.id=void 0,w.value.resetFields(),y.value=!1})},Y=()=>{n.id=void 0,n.userId=void 0,n.deptId=void 0,w.value.resetFields(),y.value=!1},Z=()=>{v(s)};return me(async()=>{o.value=await $("sys_examineAndApprove_status"),r.value=await $("sys_makeUpCard_type"),o.value.forEach(a=>{a.value=a.dictValue,a.lable=a.dictLabel}),r.value.forEach(a=>{a.value=a.dictValue,a.lable=a.dictLabel}),Z()}),K(V({t,loading:e,queryParams:s,formFields:P,handleQuery:F,tableList:C,columns:Ae,pagination:p,hasSelected:I,handleTableChange:B,selectDictLabel:re,confirm:u,cancel:H,onSelectChange:N},ke(g)),{handleExamineAndApprove:j,handleClickDropdown:L,BaseFormRef:w,open:y,drawerTitle:E,examineAndApproveStatusOptions:o,makeUpCardTypeOptions:r,formState:n,formDataObj:J,rules:X,handleClose:Y,handleAdd:U,handleUpdate:d,handleSubmit:W})}}),Se={class:"p-4"},Re={class:"mb-3"},_e={class:"mr-3 text-[#faad14] cursor-pointer"};function De(e,o,r,w,s,P){const F=m("form-search"),C=m("a-button"),p=m("a-col"),h=m("a-popconfirm"),g=m("a-row"),I=m("a-menu-item"),N=m("a-menu"),L=m("a-dropdown"),j=m("a-table"),B=m("BaseForm"),v=m("a-drawer"),U=Ce("has-permi");return O(),x("div",Se,[f("div",Re,[c(F,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),c(g,{gutter:10,class:"mb-2"},{default:l(()=>[_(c(p,null,{default:l(()=>[c(C,{color:"success",onClick:e.handleAdd},{default:l(()=>[D(k(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[U,["examineAndApprove:makeUpCard:add"]]]),_(c(p,null,{default:l(()=>[c(h,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:l(()=>[c(C,{disabled:!e.hasSelected,color:"error"},{default:l(()=>[D(k(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[U,["examineAndApprove:makeUpCard:delete"]]])]),_:1}),c(j,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:l(({record:d})=>[f("span",null,k(d.user.nickName),1)]),clock_in:l(({record:d})=>{var u;return[f("span",null,k((u=d.clock_in)==null?void 0:u.createdAt),1)]}),type:l(({record:d})=>[f("span",null,k(e.selectDictLabel(e.makeUpCardTypeOptions,d.type)),1)]),status:l(({record:d})=>[f("span",null,k(e.selectDictLabel(e.examineAndApproveStatusOptions,d.status)),1)]),action:l(({record:d})=>[f("span",null,[_(f("span",null,[c(L,{trigger:["click"],onClick:u=>e.handleClickDropdown(d)},{overlay:l(()=>[c(N,{onClick:e.handleExamineAndApprove},{default:l(()=>[(O(!0),x(ve,null,fe(e.examineAndApproveStatusOptions,u=>(O(),he(I,{disabled:u.dictValue==="0",key:u.dictValue},{default:l(()=>[D(k(u.dictLabel),1)]),_:2},1032,["disabled"]))),128))]),_:1},8,["onClick"])]),default:l(()=>[f("span",_e,k(e.t("routes.makeUpCard.approve")),1)]),_:2},1032,["onClick"])],512),[[U,["examineAndApprove:makeUpCard:update"]]]),_(c(C,{type:"link",color:"success",class:"mr-3",onClick:u=>e.handleUpdate(d)},{default:l(()=>[D(k(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[U,["examineAndApprove:makeUpCard:update"]]]),c(h,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:u=>e.confirm(d),onCancel:e.cancel},{default:l(()=>[_(c(C,{type:"link",color:"error"},{default:l(()=>[D(k(e.t("common.delete")),1)]),_:1},512),[[U,["examineAndApprove:makeUpCard:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),c(v,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":o[0]||(o[0]=d=>e.open=d),maskClosable:!1,onClose:e.handleClose},{default:l(()=>[c(B,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var Oe=se(we,[["render",De]]);export{Oe as default};
