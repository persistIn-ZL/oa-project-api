var Q=Object.defineProperty,U=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var _=(e,t,n)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))q.call(t,n)&&_(e,n,t[n]);if(T)for(var n of T(t))G.call(t,n)&&_(e,n,t[n]);return e},B=(e,t)=>U(e,V(t));import{g as J,a as W,d as X,u as Z,b as ee}from"./index.e1ede277.js";import{_ as ae,a as ne}from"./index.da4ff793.js";import{B as oe}from"./index.7fa8a761.js";import{d as te,c as E,r as N,a as v,f as le,a6 as se,q as p,a3 as re,t as de,y as ie,z as g,k as s,x as l,S as C,R as y,a4 as R,ay as K,n as ue,M as S}from"./ant-design-vue.27440fdb.js";import{F as ce}from"./index.ab3e0a2d.js";import{u as me}from"./useDrawer.8b3a90cf.js";import{u as pe}from"./useI18n.25a437e0.js";const{t:a}=pe(),ye=[{title:a("routes.salary.yearAndMounth"),key:"yearAndMounth",align:"center",slots:{customRender:"yearAndMounth"}},{title:a("routes.salary.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:a("routes.salary.currentSalary"),key:"currentSalary",align:"center",slots:{customRender:"currentSalary"}},{title:a("routes.salary.expectedAttendanceHours"),dataIndex:"expectedAttendanceHours",key:"expectedAttendanceHours",align:"center"},{title:a("routes.salary.attendanceHours"),dataIndex:"attendanceHours",key:"attendanceHours",align:"center"},{title:a("routes.salary.paidLeave"),dataIndex:"paidLeave",key:"paidLeave",align:"center"},{title:a("routes.salary.unpaidLeave"),dataIndex:"unpaidLeave",key:"unpaidLeave",align:"center"},{title:a("routes.salary.beLateAndLeaveEarly"),dataIndex:"beLateAndLeaveEarly",key:"beLateAndLeaveEarly",align:"center"},{title:a("routes.salary.subsidy"),dataIndex:"subsidy",key:"subsidy",align:"center"},{title:a("routes.salary.socialSecurityAndProvidentFund"),dataIndex:"socialSecurityAndProvidentFund",key:"socialSecurityAndProvidentFund",align:"center"},{title:a("routes.salary.other"),dataIndex:"other",key:"other",align:"center"},{title:a("routes.salary.total"),dataIndex:"total",key:"total",align:"center"},{title:a("routes.salary.action"),key:"action",align:"center",slots:{customRender:"action"}}],he=te({components:{FormSearch:ce,BaseForm:oe},setup(){const e=E(()=>ne().loading),t=N(),n=v({pageNum:1,pageSize:10,nickName:"",yearAndMounth:""}),H=v([{type:"input",label:a("routes.salary.nickName"),name:"nickName",value:"",placeholder:a("routes.salary.nickNamePlaceholder")},{type:"month-picker",label:a("routes.salary.yearAndMounth"),name:"yearAndMounth",value:"",placeholder:a("routes.salary.yearAndMounthPlaceholder")}]),D=o=>{d.value.current=1,n.pageNum=d.value.current,n.nickName=o.nickName,n.yearAndMounth=o.yearAndMounth?K(o.yearAndMounth).format("YYYY-MM"):"",m(n)},f=N([]),d=N({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:o=>`\u5171 ${o} \u6761`}),i=v({selectedRowKeys:[]}),A=o=>K(o).format("YYYY-MM"),k=E(()=>i.selectedRowKeys.length>0),L=o=>{console.log("selectedRowKeys changed: ",o),i.selectedRowKeys=o},M=o=>{d.value=o,n.pageNum=d.value.current,n.pageSize=d.value.pageSize,m(n)},m=o=>{J(o).then(c=>{console.log(c),f.value=c.data.rows,d.value.total=c.data.count,i.selectedRowKeys=[]})},w=()=>{h.value=!0,P.value=a("common.add")},b=o=>{W(o.id).then(c=>{h.value=!0,P.value=a("common.update"),ue(()=>{Object.keys(u).forEach(I=>{u[I]=c.data[I]}),console.log(u)})})},r=o=>{const c=o.id||i.selectedRowKeys;X(c).then(()=>{(c.length&&c.length===f.value.length||f.value.length===1)&&Math.ceil(d.value.total/n.pageSize)===n.pageNum&&n.pageNum>1&&n.pageNum--,m(n),S.success(a("common.deleteSuccess"))})},F=o=>{console.log(o),S.success(a("common.cancelDelete"))},{open:h,drawerTitle:P}=me(),Y=v({yearAndMounth:[{required:!0,message:a("routes.salary.yearAndMounthPlaceholder")}]}),z=v([{name:"yearAndMounth",label:a("routes.salary.yearAndMounth"),type:"month-picker",value:void 0,span:24,labelCol:8,placeholder:a("routes.salary.yearAndMounthPlaceholder")},{name:"expectedAttendanceHours",label:a("routes.salary.expectedAttendanceHours"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.expectedAttendanceHoursPlaceholder")},{name:"attendanceHours",label:a("routes.salary.attendanceHours"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.attendanceHoursPlaceholder")},{name:"paidLeave",label:a("routes.salary.paidLeave"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.paidLeavePlaceholder")},{name:"unpaidLeave",label:a("routes.salary.unpaidLeave"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.unpaidLeavePlaceholder")},{name:"beLateAndLeaveEarly",label:a("routes.salary.beLateAndLeaveEarly"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.beLateAndLeaveEarlyPlaceholder")},{name:"subsidy",label:a("routes.salary.subsidy"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.subsidyPlaceholder"),props:{precision:2}},{name:"socialSecurityAndProvidentFund",label:a("routes.salary.socialSecurityAndProvidentFund"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.socialSecurityAndProvidentFundPlaceholder"),props:{precision:2}},{name:"other",label:a("routes.salary.other"),type:"input-number",span:24,labelCol:8,value:void 0,placeholder:a("routes.salary.otherPlaceholder"),props:{precision:2}}]),u=v({id:void 0,yearAndMounth:void 0,expectedAttendanceHours:void 0,attendanceHours:void 0,paidLeave:void 0,unpaidLeave:void 0,beLateAndLeaveEarly:void 0,subsidy:void 0,socialSecurityAndProvidentFund:void 0,other:void 0}),$=()=>{u.id?Z(u).then(o=>{S.success(o.message),m(n),u.id=void 0,t.value.resetFields(),h.value=!1}):ee(u).then(o=>{S.success(o.message),m(n),u.id=void 0,t.value.resetFields(),h.value=!1})},x=()=>{u.id=void 0,t.value.resetFields(),h.value=!1},O=()=>{m(n)};return le(async()=>{O()}),B(j({t:a,loading:e,queryParams:n,formFields:H,handleQuery:D,tableList:f,columns:ye,pagination:d,hasSelected:k,getMounth:A,handleTableChange:M,confirm:r,cancel:F,onSelectChange:L,handleAdd:w,handleUpdate:b},se(i)),{BaseFormRef:t,open:h,drawerTitle:P,formState:u,rules:Y,formDataObj:z,handleClose:x,handleSubmit:$})}}),ve={class:"p-4"},fe={class:"mb-3"};function be(e,t,n,H,D,f){const d=p("form-search"),i=p("a-button"),A=p("a-col"),k=p("a-popconfirm"),L=p("a-row"),M=p("a-table"),m=p("BaseForm"),w=p("a-drawer"),b=re("has-permi");return de(),ie("div",ve,[g("div",fe,[s(d,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),s(L,{gutter:10,class:"mb-2"},{default:l(()=>[s(A,null,{default:l(()=>[s(i,{color:"success",onClick:e.handleAdd},{default:l(()=>[C(y(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1}),R(s(A,null,{default:l(()=>[s(k,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:l(()=>[s(i,{disabled:!e.hasSelected,color:"error"},{default:l(()=>[C(y(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[b,["finance:salary:add"]]])]),_:1}),s(M,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{yearAndMounth:l(({record:r})=>[g("span",null,y(e.getMounth(r.yearAndMounth)),1)]),user:l(({record:r})=>[g("span",null,y(r.user.nickName),1)]),currentSalary:l(({record:r})=>[g("span",null,y(r.user.salary),1)]),action:l(({record:r})=>[g("span",null,[R(s(i,{type:"link",color:"success",class:"mr-3",onClick:F=>e.handleUpdate(r)},{default:l(()=>[C(y(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[b,["finance:salary:update"]]]),s(k,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:F=>e.confirm(r),onCancel:e.cancel},{default:l(()=>[R(s(i,{type:"link",color:"error"},{default:l(()=>[C(y(e.t("common.delete")),1)]),_:1},512),[[b,["finance:salary:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),s(w,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":t[0]||(t[0]=r=>e.open=r),maskClosable:!1,onClose:e.handleClose},{default:l(()=>[s(m,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var Fe=ae(he,[["render",be]]);export{Fe as default};
