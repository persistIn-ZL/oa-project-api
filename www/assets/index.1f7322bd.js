var ne=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var Y=(e,o,i)=>o in e?ne(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,$=(e,o)=>{for(var i in o||(o={}))se.call(o,i)&&Y(e,i,o[i]);if(M)for(var i of M(o))le.call(o,i)&&Y(e,i,o[i]);return e},x=(e,o)=>oe(e,ae(o));import{H as S,_ as ie,a as ce}from"./index.da4ff793.js";import{g as H,s as re}from"./dictFormat.31da75fc.js";import{B as de}from"./index.7fa8a761.js";import{F as ue}from"./index.ab3e0a2d.js";import{u as me}from"./useDrawer.8b3a90cf.js";import{u as pe}from"./useI18n.25a437e0.js";import{d as ve,c as U,r as C,a as w,f as fe,a6 as he,q as m,a3 as ge,t as P,y as q,z as k,k as r,x as l,a4 as R,S as _,R as h,F as ye,X as be,v as ke,M as F,n as V}from"./ant-design-vue.27440fdb.js";function Te(e={}){return S("/admin/examineAndApprove/evection","GET",e)}function Q(e){return S("/admin/examineAndApprove/evection/"+e,"GET",{},!1)}function Ae(e){return S("/admin/examineAndApprove/evection/"+e,"DELETE")}function Ce(e={}){return S("/admin/examineAndApprove/evection","POST",e)}function G(e){return S("/admin/examineAndApprove/evection/"+e.id,"PUT",e)}const{t:n}=pe(),we=[{title:n("routes.evection.nickName"),key:"user",align:"center",slots:{customRender:"user"}},{title:n("routes.evection.evectionType"),dataIndex:"type",key:"type",align:"center",slots:{customRender:"type"}},{title:n("routes.evection.evectionDuration"),dataIndex:"evectionDuration",key:"evectionDuration",align:"center"},{title:n("routes.evection.evectionReason"),dataIndex:"evectionReason",key:"evectionReason",align:"center"},{title:n("routes.evection.startTime"),dataIndex:"startTime",key:"startTime",align:"center"},{title:n("routes.evection.endTime"),dataIndex:"endTime",key:"endTime",align:"center"},{title:n("routes.evection.status"),dataIndex:"status",key:"status",slots:{customRender:"status"},align:"center"},{title:n("routes.evection.remark"),dataIndex:"remark",key:"remark",align:"center"},{title:n("routes.evection.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:n("routes.evection.action"),key:"action",align:"center",slots:{customRender:"action"}}],De=ve({components:{FormSearch:ue,BaseForm:de},setup(){const e=U(()=>ce().loading),o=C([]),i=C([]),D=C(),a=w({pageNum:1,pageSize:10,nickName:"",type:"",status:""}),K=w([{type:"input",label:n("routes.evection.nickName"),name:"nickName",value:"",placeholder:n("routes.evection.nickNamePlaceholder")},{type:"select",label:n("routes.evection.status"),name:"status",value:void 0,placeholder:n("routes.evection.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:i},{type:"select",label:n("routes.evection.evectionType"),name:"type",value:void 0,placeholder:n("routes.evection.evectionTypePlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:o}]),E=t=>{u.value.current=1,a.pageNum=u.value.current,a.nickName=t.nickName,a.type=t.type,a.status=t.status,v(a)},p=C([]),u=C({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:t=>`\u5171 ${t} \u6761`}),T=C(),y=w({selectedRowKeys:[]}),N=U(()=>y.selectedRowKeys.length>0),L=t=>{console.log("selectedRowKeys changed: ",t),y.selectedRowKeys=t},j=t=>{T.value=t},O=async({key:t})=>{T.value&&(await Q(T.value.id).then(c=>{Object.keys(s).forEach(f=>{s[f]=c.data[f]})}),s.status=t,G(s).then(c=>{F.success(c.message),v(a)}))},B=t=>{u.value=t,a.pageNum=u.value.current,a.pageSize=u.value.pageSize,v(a)},v=t=>{Te(t).then(c=>{console.log(c),p.value=c.data.rows,u.value.total=c.data.count,y.selectedRowKeys=[]})},b=()=>{A.value=!0,I.value=n("common.add")},d=t=>{Q(t.id).then(c=>{A.value=!0,I.value=n("common.update"),V(()=>{Object.keys(s).forEach(f=>{s[f]=c.data[f],s.time=["",""],f==="startTime"&&V(()=>{s.time[0]=c.data[f]}),f==="endTime"&&V(()=>{s.time[1]=c.data[f]})})})})},g=t=>{const c=t.id||y.selectedRowKeys;Ae(c).then(()=>{(c.length&&c.length===p.value.length||p.value.length===1)&&Math.ceil(u.value.total/a.pageSize)===a.pageNum&&a.pageNum>1&&a.pageNum--,v(a),F.success(n("common.deleteSuccess"))})},X=t=>{console.log(t),F.success(n("common.cancelDelete"))},{open:A,drawerTitle:I}=me(),s=w({id:void 0,evectionDate:"",type:void 0,evectionReason:void 0,time:[],startTime:"",endTime:""}),J=w({time:[{required:!0,message:n("routes.evection.evectionDurationPlaceholder")}],type:[{required:!0,message:n("routes.evection.evectionTypePlaceholder")}]}),z=t=>{s.startTime=t[0],s.endTime=t[1]},W=w([{name:"time",label:n("routes.evection.selectTime"),type:"range-picker",value:void 0,span:24,props:{format:"YYYY-MM-DD HH:mm",placeholder:[n("routes.evection.startTime"),n("routes.evection.endTime")],valueFormat:"YYYY-MM-DD HH:mm"},fn:{ok:z,change:z}},{name:"type",label:n("routes.evection.evectionType"),type:"select",value:void 0,span:24,placeholder:n("routes.evection.evectionTypePlaceholder"),options:o,serialize:{value:"dictValue",label:"dictLabel"}},{name:"evectionReason",label:n("routes.evection.evectionReason"),type:"textarea",value:void 0,span:24,placeholder:n("routes.evection.evectionReasonPlaceholder")}]),Z=()=>{console.log(s),s.id?G(s).then(t=>{F.success(t.message),v(a),s.id=void 0,D.value.resetFields(),A.value=!1}):Ce(s).then(t=>{F.success(t.message),v(a),s.id=void 0,D.value.resetFields(),A.value=!1})},ee=()=>{s.id=void 0,A.value=!1,D.value.resetFields()},te=()=>{v(a)};return fe(async()=>{o.value=await H("sys_evection_type"),i.value=await H("sys_examineAndApprove_status"),o.value.forEach(t=>{t.value=t.dictValue,t.lable=t.dictLabel}),i.value.forEach(t=>{t.value=t.dictValue,t.lable=t.dictLabel}),te()}),x($({t:n,loading:e,queryParams:a,formFields:K,handleQuery:E,tableList:p,columns:we,pagination:u,hasSelected:N,handleTableChange:B,selectDictLabel:re,confirm:g,cancel:X,onSelectChange:L},he(y)),{handleExamineAndApprove:O,handleClickDropdown:j,BaseFormRef:D,open:A,drawerTitle:I,evectionTypeOptions:o,examineAndApproveStatusOptions:i,formState:s,formDataObj:W,rules:J,handleClose:ee,onOkTime:z,handleAdd:b,handleUpdate:d,handleSubmit:Z})}}),Se={class:"p-4"},Re={class:"mb-3"},_e={class:"mr-3 text-[#faad14] cursor-pointer"};function Fe(e,o,i,D,a,K){const E=m("form-search"),p=m("a-button"),u=m("a-col"),T=m("a-popconfirm"),y=m("a-row"),N=m("a-menu-item"),L=m("a-menu"),j=m("a-dropdown"),O=m("a-table"),B=m("BaseForm"),v=m("a-drawer"),b=ge("has-permi");return P(),q("div",Se,[k("div",Re,[r(E,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),r(y,{gutter:10,class:"mb-2"},{default:l(()=>[R(r(u,null,{default:l(()=>[r(p,{color:"success",onClick:e.handleAdd},{default:l(()=>[_(h(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[b,["examineAndApprove:evection:add"]]]),R(r(u,null,{default:l(()=>[r(T,{title:e.t("common.confirmDeleteSelect"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:l(()=>[r(p,{disabled:!e.hasSelected,color:"error"},{default:l(()=>[_(h(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[b,["examineAndApprove:evection:delete"]]])]),_:1}),r(O,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.tableList,pagination:e.pagination,onChange:e.handleTableChange},{user:l(({record:d})=>[k("span",null,h(d.user.nickName),1)]),type:l(({record:d})=>[k("span",null,h(e.selectDictLabel(e.evectionTypeOptions,d.type)),1)]),status:l(({record:d})=>[k("span",null,h(e.selectDictLabel(e.examineAndApproveStatusOptions,d.status)),1)]),action:l(({record:d})=>[k("span",null,[R(k("span",null,[r(j,{trigger:["click"],onClick:g=>e.handleClickDropdown(d)},{overlay:l(()=>[r(L,{onClick:e.handleExamineAndApprove},{default:l(()=>[(P(!0),q(ye,null,be(e.examineAndApproveStatusOptions,g=>(P(),ke(N,{disabled:g.dictValue==="0",key:g.dictValue},{default:l(()=>[_(h(g.dictLabel),1)]),_:2},1032,["disabled"]))),128))]),_:1},8,["onClick"])]),default:l(()=>[k("span",_e,h(e.t("routes.evection.approve")),1)]),_:2},1032,["onClick"])],512),[[b,["examineAndApprove:evection:update"]]]),R(r(p,{type:"link",color:"success",class:"mr-3",onClick:g=>e.handleUpdate(d)},{default:l(()=>[_(h(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[b,["examineAndApprove:evection:update"]]]),r(T,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:g=>e.confirm(d),onCancel:e.cancel},{default:l(()=>[R(r(p,{type:"link",color:"error"},{default:l(()=>[_(h(e.t("common.delete")),1)]),_:1},512),[[b,["examineAndApprove:evection:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),r(v,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":o[0]||(o[0]=d=>e.open=d),maskClosable:!1,onClose:e.handleClose},{default:l(()=>[r(B,{ref:"BaseFormRef",formData:e.formDataObj,data:e.formState,rules:e.rules,onSubmit:e.handleSubmit,onClose:e.handleClose},null,8,["formData","data","rules","onSubmit","onClose"])]),_:1},8,["title","visible","onClose"])])}var Pe=ie(De,[["render",Fe]]);export{Pe as default};
