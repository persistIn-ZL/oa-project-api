import{d as M,c as P,r as y,a as K,f as G,q as d,a3 as H,t as q,y as J,k as a,x as o,a4 as D,S as w,R as g,z as T,v as Q,a5 as W,D as X,M as B,n as F}from"./ant-design-vue.27440fdb.js";import{u as Y,a as Z,d as x,g as E,b as ee}from"./index.0e842432.js";import{_ as te,a as ae,u as oe,h as z}from"./index.da4ff793.js";import{T as ne,f as L}from"./validate.f7694c3d.js";import{u as le}from"./useDrawer.8b3a90cf.js";import{g as se}from"./dictFormat.31da75fc.js";import{u as de}from"./useI18n.25a437e0.js";const{t:r}=de(),re=[{title:r("routes.dept.deptName"),dataIndex:"deptName",key:"deptName"},{title:r("routes.dept.orderNum"),dataIndex:"orderNum",key:"orderNum",align:"center"},{title:r("routes.dept.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:r("routes.dept.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:r("routes.dept.action"),key:"action",align:"center",slots:{customRender:"action"}}],ue=M({components:{Treeselect:ne},setup(){const e=P(()=>ae().loading),s=y([]),v=oe(),S=y(),O={parentId:[{required:!0,validator:L.number,message:r("routes.dept.superiorDepartmentCannotBeBlank"),trigger:"change"}],deptName:[{required:!0,message:r("routes.dept.deptNameCannotBeBlank"),trigger:"blur"}],orderNum:[{required:!0,validator:L.number,message:r("routes.dept.orderNumCannotBeBlank"),trigger:"blur"}]},k=y(),m=t=>(t.children&&!t.children.length&&delete t.children,{id:t.deptId,label:t.deptName,children:t.children}),p=y([]),h=y([]),C=()=>{E().then(t=>{const i=z(t.data.rows,"deptId","parentId","children",v.userInfo.deptId).tree,b=t.data.rows.filter(c=>c.deptId===v.userInfo.deptId);b[0].children=i,h.value=b,p.value=b})},l=K({deptId:void 0,parentId:void 0,deptName:void 0,orderNum:"1",status:"1"}),{open:f,drawerTitle:_}=le(),I=()=>{l.deptId=void 0,k.value.resetFields(),console.log(l),f.value=!1},j=()=>{console.log(l),k.value.validate().then(()=>{l.deptId?Y(l).then(t=>{B.success(t.message),C(),l.deptId=void 0,k.value.resetFields(),f.value=!1}):Z(l).then(t=>{B.success(t.message),C(),l.deptId=void 0,k.value.resetFields(),f.value=!1})}).catch(t=>{console.log("error",t)})},R=t=>{x(t.deptId).then(()=>{C(),B.success(r("common.deleteSuccess"))})},A=t=>{console.log(t),B.success(r("common.cancelDelete"))},U=t=>{E().then(i=>{i.data.rows.forEach(u=>{u.isDisabled=!1});const b=z(i.data.rows,"deptId","parentId","children",v.userInfo.deptId).tree,c=i.data.rows.filter(u=>u.deptId===v.userInfo.deptId);c[0].children=b,h.value=c,p.value=c,f.value=!0,_.value=r("common.add"),t!=null&&t.deptId&&F(()=>{l.parentId=t.deptId,S.value&&S.value.forest.selectedNodeIds.push(t.deptId)})})},$=t=>{E().then(i=>{i.data.rows.forEach(u=>{u.deptId===t.deptId?u.isDisabled=!0:u.isDisabled=!1});const b=z(i.data.rows,"deptId","parentId","children",v.userInfo.deptId).tree,c=i.data.rows.filter(u=>u.deptId===v.userInfo.deptId);c[0].children=b,h.value=c,p.value=c,ee(t.deptId).then(u=>{f.value=!0,_.value=r("common.update"),F(()=>{Object.keys(l).forEach(V=>{l[V]=u.data[V]}),S.value.forest.selectedNodeIds.push(u.data.parentId)})})})},N=t=>{l.parentId=t.deptId},n=()=>{C()};return G(async()=>{s.value=await se("sys_normal_disable"),s.value.forEach(t=>{t.label=t.dictLabel,t.value=t.dictValue}),n()}),{t:r,loading:e,deptList:h,confirm:R,cancel:A,columns:re,handleAdd:U,handleUpdate:$,open:f,drawerTitle:_,handleClose:I,handleSubmit:j,formState:l,labelCol:{span:6},wrapperCol:{span:18},normalizer:m,deptOptions:p,rules:O,formRef:k,treeRef:S,handleTreeSelect:N,disableOptions:s}}}),pe={class:"p-4"},ie={class:"flex justify-center"},ce={class:"flex justify-center"};function me(e,s,v,S,O,k){const m=d("a-button"),p=d("a-col"),h=d("a-row"),C=d("svg-icon"),l=d("a-popconfirm"),f=d("a-table"),_=d("treeselect"),I=d("a-form-item"),j=d("a-input"),R=d("a-input-number"),A=d("a-radio-group"),U=d("a-form"),$=d("a-drawer"),N=H("has-permi");return q(),J("div",pe,[a(h,{gutter:10,class:"mb-2"},{default:o(()=>[D(a(p,null,{default:o(()=>[a(m,{color:"success",onClick:e.handleAdd},{default:o(()=>[w(g(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[N,["system:department:add"]]])]),_:1}),a(f,{loading:e.loading,rowKey:"deptId",columns:e.columns,"data-source":e.deptList,defaultExpandAllRows:!0,pagination:!1},{icon:o(({record:n})=>[T("div",ie,[a(C,{name:n.icon},null,8,["name"])])]),status:o(({record:n})=>[T("div",ce,[T("span",null,g(n.status==="1"?e.t("common.normal"):e.t("common.deactivate")),1)])]),action:o(({record:n})=>[T("span",null,[D(a(m,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleAdd(n)},{default:o(()=>[w(g(e.t("common.add")),1)]),_:2},1032,["onClick"]),[[N,["system:department:add"]]]),D(a(m,{type:"link",color:"success",class:"mr-3",onClick:t=>e.handleUpdate(n)},{default:o(()=>[w(g(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[N,["system:department:update"]]]),a(l,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:t=>e.confirm(n),onCancel:e.cancel},{default:o(()=>[D(a(m,{type:"link",color:"error"},{default:o(()=>[w(g(e.t("common.delete")),1)]),_:1},512),[[N,["system:department:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","columns","data-source"]),a($,{width:"50%",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":s[4]||(s[4]=n=>e.open=n),maskClosable:!1,onClose:e.handleClose},{default:o(()=>[e.open?(q(),Q(U,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:o(()=>[a(h,null,{default:o(()=>[D(a(p,{span:12},{default:o(()=>[a(I,{label:e.t("routes.dept.superiorDepartment"),name:"parentId"},{default:o(()=>[a(_,{ref:"treeRef",class:"!mt-[3px]",value:e.formState.parentId,"onUpdate:value":s[0]||(s[0]=n=>e.formState.parentId=n),normalizer:e.normalizer,placeholder:e.t("routes.dept.superiorDepartmentPlaceholder"),options:e.deptOptions,onSelect:e.handleTreeSelect},null,8,["value","normalizer","placeholder","options","onSelect"])]),_:1},8,["label"])]),_:1},512),[[W,e.formState.parentId!==0]]),a(p,{span:12},{default:o(()=>[a(I,{label:e.t("routes.dept.deptName"),name:"deptName"},{default:o(()=>[a(j,{value:e.formState.deptName,"onUpdate:value":s[1]||(s[1]=n=>e.formState.deptName=n),placeholder:e.t("routes.dept.deptNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(p,{span:12},{default:o(()=>[a(I,{label:e.t("routes.dept.orderNum"),name:"orderNum"},{default:o(()=>[a(R,{class:"!w-[100%]",value:e.formState.orderNum,"onUpdate:value":s[2]||(s[2]=n=>e.formState.orderNum=n),placeholder:e.t("routes.dept.orderNumPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),a(p,{span:12},{default:o(()=>[a(I,{label:e.t("routes.dept.status"),name:"status"},{default:o(()=>[a(A,{value:e.formState.status,"onUpdate:value":s[3]||(s[3]=n=>e.formState.status=n),options:e.disableOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),a(p,{span:24},{default:o(()=>[a(I,null,{default:o(()=>[a(m,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:o(()=>[w(g(e.t("common.okText")),1)]),_:1},8,["onClick"]),a(m,{onClick:e.handleClose},{default:o(()=>[w(g(e.t("common.cancelText")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","label-col","wrapper-col"])):X("",!0)]),_:1},8,["title","visible","onClose"])])}var Ce=te(ue,[["render",me]]);export{Ce as default};
