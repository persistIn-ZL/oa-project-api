var pe=Object.defineProperty,fe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable;var J=(e,a,i)=>a in e?pe(e,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[a]=i,W=(e,a)=>{for(var i in a||(a={}))he.call(a,i)&&J(e,i,a[i]);if(H)for(var i of H(a))ge.call(a,i)&&J(e,i,a[i]);return e},Y=(e,a)=>fe(e,ve(a));import{g as Se,u as Z,a as be,d as ye,b as x}from"./index.004b7213.js";import{_ as ke,a as Ce,f as we,h as Ne}from"./index.da4ff793.js";import{g as ee,s as Ke}from"./dictFormat.31da75fc.js";import{u as Re}from"./useDrawer.8b3a90cf.js";import{F as Ie}from"./index.ab3e0a2d.js";import{u as Te}from"./useI18n.25a437e0.js";import{d as Oe,c as oe,r as b,a as R,f as De,a6 as le,q as c,a3 as Fe,t as D,y as ae,z,k as o,x as l,a4 as F,S,R as f,v as V,D as te,F as Pe,X as Ue,M as P,n as se}from"./ant-design-vue.27440fdb.js";const{t:r}=Te(),je=[{title:r("routes.role.roleName"),dataIndex:"roleName",key:"roleName",align:"center"},{title:r("routes.role.roleKey"),dataIndex:"roleKey",key:"roleKey",align:"center"},{title:r("routes.role.roleSort"),dataIndex:"roleSort",key:"roleSort",align:"center"},{title:r("routes.role.status"),dataIndex:"status",key:"status",align:"center",slots:{customRender:"status"}},{title:r("routes.role.createdBy"),dataIndex:"createdBy",key:"createdBy",align:"center"},{title:r("routes.role.createdAt"),dataIndex:"createdAt",key:"createdAt",align:"center"},{title:r("routes.role.action"),key:"action",align:"center",slots:{customRender:"action"}}],Ee=Oe({components:{FormSearch:Ie},setup(){const e=oe(()=>Ce().loading),a=b([]),i=b([]),_=()=>[...T.value.checked].length?Promise.resolve():Promise.reject(r("routes.role.menuPermissionIsEmpty")),Q={roleName:[{required:!0,message:r("routes.role.roleNameIsEmpty"),trigger:"blur"}],roleKey:[{required:!0,message:r("routes.role.roleKeyIsEmpty"),trigger:"blur"}],status:[{required:!0,message:r("routes.role.statusIsEmpty"),trigger:"change"}],menuIds:[{required:!0,validator:_,trigger:"change"}]},u=R({pageNum:1,pageSize:10,roleName:"",status:""}),A=R([{type:"input",label:r("routes.role.roleName"),name:"roleName",value:"",placeholder:r("routes.role.roleNamePlaceholder")},{type:"select",label:r("routes.role.status"),name:"status",value:void 0,placeholder:r("routes.role.statusPlaceholder"),normalizer:{value:"dictValue",label:"dictLabel"},options:a}]),v=t=>{h.value.current=1,u.pageNum=h.value.current,u.roleName=t.roleName,u.status=t.status,d(u)},n=b([]),h=b({total:0,current:1,pageSize:10,showSizeChanger:!0,showTotal:t=>`\u5171 ${t} \u6761`}),I=t=>{h.value=t,u.pageNum=h.value.current,u.pageSize=h.value.pageSize,d(u)},C=R({selectedRowKeys:[]}),L=oe(()=>C.selectedRowKeys.length>0),N=t=>{console.log("selectedRowKeys changed: ",t),C.selectedRowKeys=t},d=t=>{Se(t).then(m=>{console.log(m),n.value=m.data.rows,h.value.total=m.data.count,C.selectedRowKeys=[],n.value.forEach(g=>{g.status==="1"?g.checked=!0:g.checked=!1})})},$=()=>{d(u),ne()},y=b(),p=R({id:void 0,roleName:void 0,roleKey:void 0,roleSort:1,status:"1",menuIds:void 0,remark:void 0}),{open:k,drawerTitle:K}=Re(),U=()=>{T.value.checked=[],p.id=void 0,y.value.resetFields(),console.log(y),k.value=!1},M=()=>{y.value.validate().then(()=>{p.menuIds=[...T.value.checked],p.id?Z(p).then(t=>{P.success(t.message),d(u),p.id=void 0,y.value.resetFields(),k.value=!1}):be(p).then(t=>{P.success(t.message),d(u),p.id=void 0,y.value.resetFields(),k.value=!1})}).catch(t=>{console.log("error",t)})},q=t=>{const m=t.id||C.selectedRowKeys;ye(m).then(()=>{(m.length&&m.length===n.value.length||n.value.length===1)&&Math.ceil(h.value.total/u.pageSize)===u.pageNum&&u.pageNum>1&&u.pageNum--,d(u),P.success(r("common.deleteSuccess"))})},w=t=>{console.log(t),P.success(r("common.cancelDelete"))},s=()=>{k.value=!0,K.value=r("common.add")},j=t=>{x(t.id).then(m=>{k.value=!0,K.value=r("common.update"),se(()=>{Object.keys(p).forEach(B=>{p[B]=m.data[B]});const g={checked:m.data.menus.map(B=>B.id),halfChecked:[]};T.value=le(g)})})},X=b([]),T=b({checked:[]}),re={children:"children",title:"title",key:"id"},ne=()=>{we().then(t=>{X.value=Ne(t.data.rows,"id","parentId").tree})},de=R([{value:"1",label:r("routes.role.CurrentAndBelow")},{value:"2",label:r("routes.role.current")},{value:"3",label:r("routes.role.myself")}]),G=b(),E=b(!1),ue={dataScope:[{required:!0,message:r("routes.role.menuIdsIsEmpty"),trigger:"blur"}]},O=R({id:void 0,roleName:"",roleKey:"",roleSort:void 0,status:void 0,menuIds:void 0,remark:void 0,dataScope:void 0}),ce=t=>{x(t.id).then(m=>{E.value=!0,se(()=>{Object.keys(O).forEach(g=>{O[g]=m.data[g]}),O.menuIds=m.data.menus.map(g=>g.id)})})},ie=()=>{E.value=!1},me=()=>{G.value.validate().then(()=>{console.log("ok"),Z(O).then(t=>{P.success(t.message),E.value=!1,d(u)})}).catch(t=>{console.log("error",t)})};return De(async()=>{a.value=await ee("sys_normal_disable"),i.value=await ee("sys_normal_disable"),i.value.forEach(t=>{t.label=t.dictLabel,t.value=t.dictValue}),$()}),Y(W({t:r,loading:e,queryParams:u,formFields:A,handleQuery:v,roleList:n,columns:je,pagination:h,handleTableChange:I,selectDictLabel:Ke,statusOptions:a},le(C)),{hasSelected:L,onSelectChange:N,open:k,drawerTitle:K,formState:p,labelCol:{span:4},wrapperCol:{span:20},rules:Q,formRef:y,handleClose:U,handleSubmit:M,confirm:q,cancel:w,handleAdd:s,handleUpdate:j,menuOptions:X,checkedKeys:T,replaceFields:re,disableOptions:i,dataScopeOptions:de,formScopeRef:G,dataScopeOpen:E,formScopeState:O,scopeRules:ue,handleScopeOpen:ce,handleScopeClose:ie,handleScopeSubmit:me})}}),Be={class:"p-4"},ze={class:"mb-3"},Ae={class:"text-[#1890ff]"};function Le(e,a,i,_,Q,u){const A=c("form-search"),v=c("a-button"),n=c("a-col"),h=c("a-popconfirm"),I=c("a-row"),C=c("router-link"),L=c("a-table"),N=c("a-input"),d=c("a-form-item"),$=c("a-input-number"),y=c("a-radio-group"),p=c("a-tree"),k=c("a-textarea"),K=c("a-form"),U=c("a-drawer"),M=c("a-select-option"),q=c("a-select"),w=Fe("has-permi");return D(),ae("div",Be,[z("div",ze,[o(A,{formFields:e.formFields,onSearch:e.handleQuery,onReset:e.handleQuery},null,8,["formFields","onSearch","onReset"])]),o(I,{gutter:10,class:"mb-2"},{default:l(()=>[F(o(n,null,{default:l(()=>[o(v,{color:"success",onClick:e.handleAdd},{default:l(()=>[S(f(e.t("common.add")),1)]),_:1},8,["onClick"])]),_:1},512),[[w,["system:role:add"]]]),F(o(n,null,{default:l(()=>[o(h,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:e.confirm,onCancel:e.cancel},{default:l(()=>[o(v,{disabled:!e.hasSelected,color:"error"},{default:l(()=>[S(f(e.t("common.delete")),1)]),_:1},8,["disabled"])]),_:1},8,["title","ok-text","cancel-text","onConfirm","onCancel"])]),_:1},512),[[w,["system:role:delete"]]])]),_:1}),o(L,{loading:e.loading,rowKey:"id","row-selection":{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange},columns:e.columns,"data-source":e.roleList,pagination:e.pagination,onChange:e.handleTableChange},{roleKey:l(({record:s})=>[o(C,{to:"dictData/"+s.id},{default:l(()=>[z("span",Ae,f(s.roleKey),1)]),_:2},1032,["to"])]),status:l(({record:s})=>[z("span",null,f(e.selectDictLabel(e.statusOptions,s.status)),1)]),action:l(({record:s})=>[z("span",null,[F(o(v,{type:"link",color:"success",class:"mr-3",onClick:j=>e.handleUpdate(s)},{default:l(()=>[S(f(e.t("common.update")),1)]),_:2},1032,["onClick"]),[[w,["system:role:update"]]]),F(o(v,{type:"link",color:"warning",class:"mr-3",onClick:j=>e.handleScopeOpen(s)},{default:l(()=>[S(f(e.t("routes.role.dataAuth")),1)]),_:2},1032,["onClick"]),[[w,["system:role:update"]]]),o(h,{title:e.t("common.confirmDelete"),"ok-text":e.t("common.okText"),"cancel-text":e.t("common.cancelText"),onConfirm:j=>e.confirm(s),onCancel:e.cancel},{default:l(()=>[F(o(v,{type:"link",color:"error"},{default:l(()=>[S(f(e.t("common.delete")),1)]),_:1},512),[[w,["system:role:delete"]]])]),_:2},1032,["title","ok-text","cancel-text","onConfirm","onCancel"])])]),_:1},8,["loading","row-selection","columns","data-source","pagination","onChange"]),o(U,{width:"540px",title:e.drawerTitle,placement:"right",visible:e.open,"onUpdate:visible":a[6]||(a[6]=s=>e.open=s),maskClosable:!1,onClose:e.handleClose},{default:l(()=>[e.open?(D(),V(K,{key:0,ref:"formRef",model:e.formState,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:l(()=>[o(I,null,{default:l(()=>[o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.roleName"),name:"roleName"},{default:l(()=>[o(N,{value:e.formState.roleName,"onUpdate:value":a[0]||(a[0]=s=>e.formState.roleName=s),placeholder:e.t("routes.role.roleNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.roleKey"),name:"roleKey"},{default:l(()=>[o(N,{value:e.formState.roleKey,"onUpdate:value":a[1]||(a[1]=s=>e.formState.roleKey=s),placeholder:e.t("routes.role.roleKeyPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.roleSort"),name:"roleSort"},{default:l(()=>[o($,{class:"!w-[100%]",value:e.formState.roleSort,"onUpdate:value":a[2]||(a[2]=s=>e.formState.roleSort=s),placeholder:e.t("routes.role.roleSortPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.status"),name:"status"},{default:l(()=>[o(y,{value:e.formState.status,"onUpdate:value":a[3]||(a[3]=s=>e.formState.status=s),options:e.disableOptions},null,8,["value","options"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.menuIds"),name:"menuIds"},{default:l(()=>[o(p,{blockNode:!0,checkable:"",checkStrictly:"","replace-fields":e.replaceFields,"tree-data":e.menuOptions,checkedKeys:e.checkedKeys,"onUpdate:checkedKeys":a[4]||(a[4]=s=>e.checkedKeys=s)},null,8,["replace-fields","tree-data","checkedKeys"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.remark"),name:"remark"},{default:l(()=>[o(k,{rows:3,value:e.formState.remark,"onUpdate:value":a[5]||(a[5]=s=>e.formState.remark=s),placeholder:e.t("routes.role.remarkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,null,{default:l(()=>[o(v,{type:"primary",class:"mr-3",onClick:e.handleSubmit},{default:l(()=>[S(f(e.t("common.okText")),1)]),_:1},8,["onClick"]),o(v,{onClick:e.handleClose},{default:l(()=>[S(f(e.t("common.cancelText")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","label-col","wrapper-col"])):te("",!0)]),_:1},8,["title","visible","onClose"]),o(U,{width:"540px",title:e.t("routes.role.assignDataPermissions"),placement:"right",visible:e.dataScopeOpen,"onUpdate:visible":a[10]||(a[10]=s=>e.dataScopeOpen=s),maskClosable:!1,onClose:e.handleScopeClose},{default:l(()=>[e.dataScopeOpen?(D(),V(K,{key:0,ref:"formScopeRef",model:e.formScopeState,rules:e.scopeRules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol},{default:l(()=>[o(I,null,{default:l(()=>[o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.roleName"),name:"roleName"},{default:l(()=>[o(N,{disabled:!0,value:e.formScopeState.roleName,"onUpdate:value":a[7]||(a[7]=s=>e.formScopeState.roleName=s),placeholder:e.t("routes.role.roleNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.roleKey"),name:"roleKey"},{default:l(()=>[o(N,{disabled:!0,value:e.formScopeState.roleKey,"onUpdate:value":a[8]||(a[8]=s=>e.formScopeState.roleKey=s),placeholder:e.t("routes.role.roleKeyPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,{label:e.t("routes.role.dataScope"),name:"dataScope"},{default:l(()=>[o(q,{value:e.formScopeState.dataScope,"onUpdate:value":a[9]||(a[9]=s=>e.formScopeState.dataScope=s),placeholder:e.t("routes.role.dataScopePlaceholder")},{default:l(()=>[(D(!0),ae(Pe,null,Ue(e.dataScopeOptions,s=>(D(),V(M,{key:s.value},{default:l(()=>[S(f(s.label),1)]),_:2},1024))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),o(n,{span:24},{default:l(()=>[o(d,null,{default:l(()=>[o(v,{type:"primary",class:"mr-3",onClick:e.handleScopeSubmit},{default:l(()=>[S(f(e.t("common.okText")),1)]),_:1},8,["onClick"]),o(v,{onClick:e.handleScopeClose},{default:l(()=>[S(f(e.t("common.cancelText")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules","label-col","wrapper-col"])):te("",!0)]),_:1},8,["title","visible","onClose"])])}var He=ke(Ee,[["render",Le]]);export{He as default};
